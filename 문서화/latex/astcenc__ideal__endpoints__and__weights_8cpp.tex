\doxysection{C\+:/\+Users/inhyu/\+One\+Drive/바탕 화면/랩실 내용/astc-\/encoder-\/main/\+Source/astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.cpp 파일 참조}
\hypertarget{astcenc__ideal__endpoints__and__weights_8cpp}{}\label{astcenc__ideal__endpoints__and__weights_8cpp}\index{C:/Users/inhyu/OneDrive/바탕 화면/랩실 내용/astc-\/encoder-\/main/Source/astcenc\_ideal\_endpoints\_and\_weights.cpp@{C:/Users/inhyu/OneDrive/바탕 화면/랩실 내용/astc-\/encoder-\/main/Source/astcenc\_ideal\_endpoints\_and\_weights.cpp}}
{\ttfamily \#include $<$cassert$>$}\newline
{\ttfamily \#include "{}astcenc\+\_\+internal.\+h"{}}\newline
{\ttfamily \#include "{}astcenc\+\_\+vecmathlib.\+h"{}}\newline
astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp에 대한 include 의존 그래프
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp__incl}
\end{center}
\end{figure}
\doxysubsubsection*{함수}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{astcenc__vecmathlib_8h_a3a29c3b15144cf0836ca0f4740b73d00}{vfloat}} \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca}{bilinear\+\_\+infill\+\_\+vla}} (const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&di, const float \texorpdfstring{$\ast$}{*}weights, unsigned int index)
\begin{DoxyCompactList}\small\item\em Functions for computing color endpoints and texel weights. \end{DoxyCompactList}\item 
static \mbox{\hyperlink{astcenc__vecmathlib_8h_a3a29c3b15144cf0836ca0f4740b73d00}{vfloat}} \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45}{bilinear\+\_\+infill\+\_\+vla\+\_\+2}} (const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&di, const float \texorpdfstring{$\ast$}{*}weights, unsigned int index)
\begin{DoxyCompactList}\small\item\em Compute the infilled weight for N texel indices in a decimated grid. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a3e9812129972c73914841ecc0f6a7e71}{compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+1\+\_\+comp}} (const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&blk, const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&pi, \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&ei, unsigned int component)
\begin{DoxyCompactList}\small\item\em Compute the ideal endpoints and weights for 1 color component. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_ad96c399a873ddd142d4779b6aeb74b87}{compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+2\+\_\+comp}} (const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&blk, const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&pi, \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&ei, int component1, int component2)
\begin{DoxyCompactList}\small\item\em Compute the ideal endpoints and weights for 2 color components. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a7ec20ff2556f6357cc0754c13e841262}{compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+3\+\_\+comp}} (const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&blk, const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&pi, \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&ei, unsigned int omitted\+\_\+component)
\begin{DoxyCompactList}\small\item\em Compute the ideal endpoints and weights for 3 color components. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a08aebec57ada3441207dce6a7a02797e}{compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+4\+\_\+comp}} (const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&blk, const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&pi, \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&ei)
\begin{DoxyCompactList}\small\item\em Compute the ideal endpoints and weights for 4 color components. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_afa8cab65d4b6f0cbece52eec38aed523}{compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+1plane}} (const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&blk, const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&pi, \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&ei)
\begin{DoxyCompactList}\small\item\em Compute ideal endpoint colors and weights for 1 plane of weights. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a52d3985007cfc83025661e0347bc00cc}{compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+2planes}} (const \mbox{\hyperlink{structblock__size__descriptor}{block\+\_\+size\+\_\+descriptor}} \&bsd, const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&blk, unsigned int plane2\+\_\+component, \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&ei1, \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&ei2)
\begin{DoxyCompactList}\small\item\em Compute ideal endpoint colors and weights for 2 planes of weights. \end{DoxyCompactList}\item 
float \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_aa4077e6408620eefddd42b7e159dc93c}{compute\+\_\+error\+\_\+of\+\_\+weight\+\_\+set\+\_\+1plane}} (const \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&eai, const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&di, const float \texorpdfstring{$\ast$}{*}dec\+\_\+weight\+\_\+quant\+\_\+uvalue)
\begin{DoxyCompactList}\small\item\em Compute the error of a decimated weight set for 1 plane. \end{DoxyCompactList}\item 
float \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a09a63c4b1e684f7ff9d88e5717b10bfb}{compute\+\_\+error\+\_\+of\+\_\+weight\+\_\+set\+\_\+2planes}} (const \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&eai1, const \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&eai2, const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&di, const float \texorpdfstring{$\ast$}{*}dec\+\_\+weight\+\_\+quant\+\_\+uvalue\+\_\+plane1, const float \texorpdfstring{$\ast$}{*}dec\+\_\+weight\+\_\+quant\+\_\+uvalue\+\_\+plane2)
\begin{DoxyCompactList}\small\item\em Compute the error of a decimated weight set for 2 planes. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_ae1b4e922c67d5349fc849709ca08178f}{compute\+\_\+ideal\+\_\+weights\+\_\+for\+\_\+decimation}} (const \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&ei, const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&di, float \texorpdfstring{$\ast$}{*}dec\+\_\+weight\+\_\+ideal\+\_\+value)
\begin{DoxyCompactList}\small\item\em Compute the optimal unquantized weights for a decimation table. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_af42cf444db5f16e2ed4fb642acf81f4a}{compute\+\_\+quantized\+\_\+weights\+\_\+for\+\_\+decimation}} (const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&di, float low\+\_\+bound, float high\+\_\+bound, const float \texorpdfstring{$\ast$}{*}dec\+\_\+weight\+\_\+ideal\+\_\+value, float \texorpdfstring{$\ast$}{*}weight\+\_\+set\+\_\+out, uint8\+\_\+t \texorpdfstring{$\ast$}{*}quantized\+\_\+weight\+\_\+set, \mbox{\hyperlink{astcenc__internal_8h_a806a5b8001942a6fa06d788ffec45a75}{quant\+\_\+method}} quant\+\_\+level)
\begin{DoxyCompactList}\small\item\em Compute the optimal quantized weights for a decimation table. \end{DoxyCompactList}\item 
static \mbox{\hyperlink{structvfloat4}{vfloat4}} \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a55d08b4feda289df7cbcfa6e1ed0b80c}{compute\+\_\+rgbo\+\_\+vector}} (\mbox{\hyperlink{structvfloat4}{vfloat4}} rgba\+\_\+weight\+\_\+sum, \mbox{\hyperlink{structvfloat4}{vfloat4}} weight\+\_\+weight\+\_\+sum, \mbox{\hyperlink{structvfloat4}{vfloat4}} rgbq\+\_\+sum, float psum)
\begin{DoxyCompactList}\small\item\em Compute the RGB + offset for a HDR endpoint mode \#7. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a02bcad94240678ee727ccf2f0fbfb5d3}{recompute\+\_\+ideal\+\_\+colors\+\_\+1plane}} (const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&blk, const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&pi, const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&di, const uint8\+\_\+t \texorpdfstring{$\ast$}{*}dec\+\_\+weights\+\_\+uquant, \mbox{\hyperlink{structendpoints}{endpoints}} \&ep, \mbox{\hyperlink{structvfloat4}{vfloat4}} rgbs\+\_\+vectors\mbox{[}\mbox{\hyperlink{astcenc__internal_8h_a31f42bb3da7abe95be4b6960feead130}{BLOCK\+\_\+\+MAX\+\_\+\+PARTITIONS}}\mbox{]}, \mbox{\hyperlink{structvfloat4}{vfloat4}} rgbo\+\_\+vectors\mbox{[}\mbox{\hyperlink{astcenc__internal_8h_a31f42bb3da7abe95be4b6960feead130}{BLOCK\+\_\+\+MAX\+\_\+\+PARTITIONS}}\mbox{]})
\begin{DoxyCompactList}\small\item\em For a given 1 plane weight set recompute the endpoint colors. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_afb3c455470bef24f48d7815bb78bb569}{recompute\+\_\+ideal\+\_\+colors\+\_\+2planes}} (const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&blk, const \mbox{\hyperlink{structblock__size__descriptor}{block\+\_\+size\+\_\+descriptor}} \&bsd, const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&di, const uint8\+\_\+t \texorpdfstring{$\ast$}{*}dec\+\_\+weights\+\_\+uquant\+\_\+plane1, const uint8\+\_\+t \texorpdfstring{$\ast$}{*}dec\+\_\+weights\+\_\+uquant\+\_\+plane2, \mbox{\hyperlink{structendpoints}{endpoints}} \&ep, \mbox{\hyperlink{structvfloat4}{vfloat4}} \&rgbs\+\_\+vector, \mbox{\hyperlink{structvfloat4}{vfloat4}} \&rgbo\+\_\+vector, int plane2\+\_\+component)
\begin{DoxyCompactList}\small\item\em For a given 2 plane weight set recompute the endpoint colors. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{함수 문서화}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!bilinear\_infill\_vla@{bilinear\_infill\_vla}}
\index{bilinear\_infill\_vla@{bilinear\_infill\_vla}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{bilinear\_infill\_vla()}{bilinear\_infill\_vla()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca} 
static \mbox{\hyperlink{astcenc__vecmathlib_8h_a3a29c3b15144cf0836ca0f4740b73d00}{vfloat}} bilinear\+\_\+infill\+\_\+vla (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&}]{di}{, }\item[{const float \texorpdfstring{$\ast$}{*}}]{weights}{, }\item[{unsigned int}]{index}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Functions for computing color endpoints and texel weights. 

Compute the infilled weight for N texel indices in a decimated grid.


\begin{DoxyParams}{매개변수}
{\em di} & The weight grid decimation to use. \\
\hline
{\em weights} & The decimated weight values to use. \\
\hline
{\em index} & The first texel index to interpolate.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{반환값}
The interpolated weight for the given set of SIMD\+\_\+\+WIDTH texels. 
\end{DoxyReturn}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00038}{38}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00042\ \ \ \{}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{comment}{//\ Load\ the\ bilinear\ filter\ texel\ weight\ indexes\ in\ the\ decimated\ grid}}
\DoxyCodeLine{00044\ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weight\_idx0\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1d994704cca1a088c460bd5a3058e3bc}{vint}}(di.\mbox{\hyperlink{structdecimation__info_adcee6ed79e4c94e1bcb305d429e3cff5}{texel\_weights\_tr}}[0]\ +\ index);}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weight\_idx1\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1d994704cca1a088c460bd5a3058e3bc}{vint}}(di.\mbox{\hyperlink{structdecimation__info_adcee6ed79e4c94e1bcb305d429e3cff5}{texel\_weights\_tr}}[1]\ +\ index);}
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weight\_idx2\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1d994704cca1a088c460bd5a3058e3bc}{vint}}(di.\mbox{\hyperlink{structdecimation__info_adcee6ed79e4c94e1bcb305d429e3cff5}{texel\_weights\_tr}}[2]\ +\ index);}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weight\_idx3\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1d994704cca1a088c460bd5a3058e3bc}{vint}}(di.\mbox{\hyperlink{structdecimation__info_adcee6ed79e4c94e1bcb305d429e3cff5}{texel\_weights\_tr}}[3]\ +\ index);}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{//\ Load\ the\ bilinear\ filter\ weights\ from\ the\ decimated\ grid}}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\_val0\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(weights,\ weight\_idx0);}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\_val1\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(weights,\ weight\_idx1);}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\_val2\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(weights,\ weight\_idx2);}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\_val3\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(weights,\ weight\_idx3);}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{comment}{//\ Load\ the\ weight\ contribution\ factors\ for\ each\ decimated\ weight}}
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ tex\_weight\_float0\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(di.\mbox{\hyperlink{structdecimation__info_a4d05a42b1764a046f86d4a5220cb5365}{texel\_weight\_contribs\_float\_tr}}[0]\ +\ index);}
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ tex\_weight\_float1\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(di.\mbox{\hyperlink{structdecimation__info_a4d05a42b1764a046f86d4a5220cb5365}{texel\_weight\_contribs\_float\_tr}}[1]\ +\ index);}
\DoxyCodeLine{00058\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ tex\_weight\_float2\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(di.\mbox{\hyperlink{structdecimation__info_a4d05a42b1764a046f86d4a5220cb5365}{texel\_weight\_contribs\_float\_tr}}[2]\ +\ index);}
\DoxyCodeLine{00059\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ tex\_weight\_float3\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(di.\mbox{\hyperlink{structdecimation__info_a4d05a42b1764a046f86d4a5220cb5365}{texel\_weight\_contribs\_float\_tr}}[3]\ +\ index);}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ bilinear\ interpolation\ to\ generate\ the\ per-\/texel\ weight}}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordflow}{return}\ (weight\_val0\ *\ tex\_weight\_float0\ +\ weight\_val1\ *\ tex\_weight\_float1)\ +}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ (weight\_val2\ *\ tex\_weight\_float2\ +\ weight\_val3\ *\ tex\_weight\_float3);}
\DoxyCodeLine{00064\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=248pt]{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!bilinear\_infill\_vla\_2@{bilinear\_infill\_vla\_2}}
\index{bilinear\_infill\_vla\_2@{bilinear\_infill\_vla\_2}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{bilinear\_infill\_vla\_2()}{bilinear\_infill\_vla\_2()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45} 
static \mbox{\hyperlink{astcenc__vecmathlib_8h_a3a29c3b15144cf0836ca0f4740b73d00}{vfloat}} bilinear\+\_\+infill\+\_\+vla\+\_\+2 (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&}]{di}{, }\item[{const float \texorpdfstring{$\ast$}{*}}]{weights}{, }\item[{unsigned int}]{index}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Compute the infilled weight for N texel indices in a decimated grid. 

This is specialized version which computes only two weights per texel for encodings that are only decimated in a single axis.


\begin{DoxyParams}{매개변수}
{\em di} & The weight grid decimation to use. \\
\hline
{\em weights} & The decimated weight values to use. \\
\hline
{\em index} & The first texel index to interpolate.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{반환값}
The interpolated weight for the given set of SIMD\+\_\+\+WIDTH texels. 
\end{DoxyReturn}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00078}{78}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00082\ \ \ \{}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ Load\ the\ bilinear\ filter\ texel\ weight\ indexes\ in\ the\ decimated\ grid}}
\DoxyCodeLine{00084\ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weight\_idx0\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1d994704cca1a088c460bd5a3058e3bc}{vint}}(di.\mbox{\hyperlink{structdecimation__info_adcee6ed79e4c94e1bcb305d429e3cff5}{texel\_weights\_tr}}[0]\ +\ index);}
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weight\_idx1\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1d994704cca1a088c460bd5a3058e3bc}{vint}}(di.\mbox{\hyperlink{structdecimation__info_adcee6ed79e4c94e1bcb305d429e3cff5}{texel\_weights\_tr}}[1]\ +\ index);}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//\ Load\ the\ bilinear\ filter\ weights\ from\ the\ decimated\ grid}}
\DoxyCodeLine{00088\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\_val0\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(weights,\ weight\_idx0);}
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\_val1\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(weights,\ weight\_idx1);}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{comment}{//\ Load\ the\ weight\ contribution\ factors\ for\ each\ decimated\ weight}}
\DoxyCodeLine{00092\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ tex\_weight\_float0\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(di.\mbox{\hyperlink{structdecimation__info_a4d05a42b1764a046f86d4a5220cb5365}{texel\_weight\_contribs\_float\_tr}}[0]\ +\ index);}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ tex\_weight\_float1\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(di.\mbox{\hyperlink{structdecimation__info_a4d05a42b1764a046f86d4a5220cb5365}{texel\_weight\_contribs\_float\_tr}}[1]\ +\ index);}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ bilinear\ interpolation\ to\ generate\ the\ per-\/texel\ weight}}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordflow}{return}\ (weight\_val0\ *\ tex\_weight\_float0\ +\ weight\_val1\ *\ tex\_weight\_float1);}
\DoxyCodeLine{00097\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=258pt]{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_aa4077e6408620eefddd42b7e159dc93c}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_error\_of\_weight\_set\_1plane@{compute\_error\_of\_weight\_set\_1plane}}
\index{compute\_error\_of\_weight\_set\_1plane@{compute\_error\_of\_weight\_set\_1plane}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_error\_of\_weight\_set\_1plane()}{compute\_error\_of\_weight\_set\_1plane()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_aa4077e6408620eefddd42b7e159dc93c} 
float compute\+\_\+error\+\_\+of\+\_\+weight\+\_\+set\+\_\+1plane (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{eai}{, }\item[{const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&}]{di}{, }\item[{const float \texorpdfstring{$\ast$}{*}}]{dec\+\_\+weight\+\_\+quant\+\_\+uvalue}{}\end{DoxyParamCaption})}



Compute the error of a decimated weight set for 1 plane. 

After computing ideal weights for the case with one weight per texel, we want to compute the error for decimated weight grids where weights are stored at a lower resolution. This function computes the error of the reduced grid, compared to the full grid.


\begin{DoxyParams}{매개변수}
{\em eai} & The ideal weights for the full grid. \\
\hline
{\em di} & The selected weight decimation. \\
\hline
{\em dec\+\_\+weight\+\_\+quant\+\_\+uvalue} & The quantized weights for the decimated grid.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{반환값}
The accumulated error. 
\end{DoxyReturn}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00688}{688}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00692\ \ \ \{}
\DoxyCodeLine{00693\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloatacc}}\ error\_summav\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloatacc::zero}}();}
\DoxyCodeLine{00694\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\ =\ di.\mbox{\hyperlink{structdecimation__info_a2f6c6f84342c82092324c05035b3c9c1}{texel\_count}};}
\DoxyCodeLine{00695\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(texel\_count\ >\ 0);}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ \ \ \textcolor{comment}{//\ Process\ SIMD-\/width\ chunks,\ safe\ to\ over-\/fetch\ -\/\ the\ extra\ space\ is\ zero\ initialized}}
\DoxyCodeLine{00698\ \ \ \ \ \textcolor{keywordflow}{if}\ (di.\mbox{\hyperlink{structdecimation__info_a1419dcd0f618164042315f80527d3f4f}{max\_texel\_weight\_count}}\ >\ 2)}
\DoxyCodeLine{00699\ \ \ \ \ \{}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ bilinear\ interpolation\ of\ the\ decimated\ weight\ grid}}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ current\_values\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca}{bilinear\_infill\_vla}}(di,\ dec\_weight\_quant\_uvalue,\ i);}
\DoxyCodeLine{00704\ }
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ error\ between\ the\ computed\ value\ and\ the\ ideal\ weight}}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ actual\_values\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}\ +\ i);}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ diff\ =\ current\_values\ -\/\ actual\_values;}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ significance\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}\ +\ i);}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error\ =\ diff\ *\ diff\ *\ significance;}
\DoxyCodeLine{00710\ }
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aaa291a197219a09a2e1103aec6945b3c}{haccumulate}}(error\_summav,\ error);}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00713\ \ \ \ \ \}}
\DoxyCodeLine{00714\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (di.\mbox{\hyperlink{structdecimation__info_a1419dcd0f618164042315f80527d3f4f}{max\_texel\_weight\_count}}\ >\ 1)}
\DoxyCodeLine{00715\ \ \ \ \ \{}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ bilinear\ interpolation\ of\ the\ decimated\ weight\ grid}}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ current\_values\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45}{bilinear\_infill\_vla\_2}}(di,\ dec\_weight\_quant\_uvalue,\ i);}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ error\ between\ the\ computed\ value\ and\ the\ ideal\ weight}}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ actual\_values\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}\ +\ i);}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ diff\ =\ current\_values\ -\/\ actual\_values;}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ significance\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}\ +\ i);}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error\ =\ diff\ *\ diff\ *\ significance;}
\DoxyCodeLine{00726\ }
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aaa291a197219a09a2e1103aec6945b3c}{haccumulate}}(error\_summav,\ error);}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00729\ \ \ \ \ \}}
\DoxyCodeLine{00730\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00731\ \ \ \ \ \{}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Load\ the\ weight\ set\ directly,\ without\ interpolation}}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ current\_values\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(dec\_weight\_quant\_uvalue\ +\ i);}
\DoxyCodeLine{00736\ }
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ error\ between\ the\ computed\ value\ and\ the\ ideal\ weight}}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ actual\_values\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}\ +\ i);}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ diff\ =\ current\_values\ -\/\ actual\_values;}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ significance\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}\ +\ i);}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error\ =\ diff\ *\ diff\ *\ significance;}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aaa291a197219a09a2e1103aec6945b3c}{haccumulate}}(error\_summav,\ error);}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00745\ \ \ \ \ \}}
\DoxyCodeLine{00746\ }
\DoxyCodeLine{00747\ \ \ \ \ \textcolor{comment}{//\ Resolve\ the\ final\ scalar\ accumulator\ sum}}
\DoxyCodeLine{00748\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(error\_summav);}
\DoxyCodeLine{00749\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_aa4077e6408620eefddd42b7e159dc93c_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_aa4077e6408620eefddd42b7e159dc93c_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_a09a63c4b1e684f7ff9d88e5717b10bfb}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_error\_of\_weight\_set\_2planes@{compute\_error\_of\_weight\_set\_2planes}}
\index{compute\_error\_of\_weight\_set\_2planes@{compute\_error\_of\_weight\_set\_2planes}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_error\_of\_weight\_set\_2planes()}{compute\_error\_of\_weight\_set\_2planes()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_a09a63c4b1e684f7ff9d88e5717b10bfb} 
float compute\+\_\+error\+\_\+of\+\_\+weight\+\_\+set\+\_\+2planes (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{eai1}{, }\item[{const \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{eai2}{, }\item[{const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&}]{di}{, }\item[{const float \texorpdfstring{$\ast$}{*}}]{dec\+\_\+weight\+\_\+quant\+\_\+uvalue\+\_\+plane1}{, }\item[{const float \texorpdfstring{$\ast$}{*}}]{dec\+\_\+weight\+\_\+quant\+\_\+uvalue\+\_\+plane2}{}\end{DoxyParamCaption})}



Compute the error of a decimated weight set for 2 planes. 

After computing ideal weights for the case with one weight per texel, we want to compute the error for decimated weight grids where weights are stored at a lower resolution. This function computes the error of the reduced grid, compared to the full grid.


\begin{DoxyParams}{매개변수}
{\em eai1} & The ideal weights for the full grid and plane 1. \\
\hline
{\em eai2} & The ideal weights for the full grid and plane 2. \\
\hline
{\em di} & The selected weight decimation. \\
\hline
{\em dec\+\_\+weight\+\_\+quant\+\_\+uvalue\+\_\+plane1} & The quantized weights for the decimated grid plane 1. \\
\hline
{\em dec\+\_\+weight\+\_\+quant\+\_\+uvalue\+\_\+plane2} & The quantized weights for the decimated grid plane 2.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{반환값}
The accumulated error. 
\end{DoxyReturn}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00752}{752}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00758\ \ \ \{}
\DoxyCodeLine{00759\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloatacc}}\ error\_summav\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloatacc::zero}}();}
\DoxyCodeLine{00760\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\ =\ di.\mbox{\hyperlink{structdecimation__info_a2f6c6f84342c82092324c05035b3c9c1}{texel\_count}};}
\DoxyCodeLine{00761\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(texel\_count\ >\ 0);}
\DoxyCodeLine{00762\ }
\DoxyCodeLine{00763\ \ \ \ \ \textcolor{comment}{//\ Process\ SIMD-\/width\ chunks,\ safe\ to\ over-\/fetch\ -\/\ the\ extra\ space\ is\ zero\ initialized}}
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{keywordflow}{if}\ (di.\mbox{\hyperlink{structdecimation__info_a1419dcd0f618164042315f80527d3f4f}{max\_texel\_weight\_count}}\ >\ 2)}
\DoxyCodeLine{00765\ \ \ \ \ \{}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Plane\ 1}}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ bilinear\ interpolation\ of\ the\ decimated\ weight\ grid}}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ current\_values1\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca}{bilinear\_infill\_vla}}(di,\ dec\_weight\_quant\_uvalue\_plane1,\ i);}
\DoxyCodeLine{00771\ }
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ error\ between\ the\ computed\ value\ and\ the\ ideal\ weight}}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ actual\_values1\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai1.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}\ +\ i);}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ diff\ =\ current\_values1\ -\/\ actual\_values1;}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error1\ =\ diff\ *\ diff\ *\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai1.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}\ +\ i);}
\DoxyCodeLine{00776\ }
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Plane\ 2}}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ bilinear\ interpolation\ of\ the\ decimated\ weight\ grid}}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ current\_values2\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca}{bilinear\_infill\_vla}}(di,\ dec\_weight\_quant\_uvalue\_plane2,\ i);}
\DoxyCodeLine{00780\ }
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ error\ between\ the\ computed\ value\ and\ the\ ideal\ weight}}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ actual\_values2\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai2.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}\ +\ i);}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \ \ \ \ diff\ =\ current\_values2\ -\/\ actual\_values2;}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error2\ =\ diff\ *\ diff\ *\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai2.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}\ +\ i);}
\DoxyCodeLine{00785\ }
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aaa291a197219a09a2e1103aec6945b3c}{haccumulate}}(error\_summav,\ error1\ +\ error2);}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00788\ \ \ \ \ \}}
\DoxyCodeLine{00789\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (di.\mbox{\hyperlink{structdecimation__info_a1419dcd0f618164042315f80527d3f4f}{max\_texel\_weight\_count}}\ >\ 1)}
\DoxyCodeLine{00790\ \ \ \ \ \{}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Plane\ 1}}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ bilinear\ interpolation\ of\ the\ decimated\ weight\ grid}}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ current\_values1\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45}{bilinear\_infill\_vla\_2}}(di,\ dec\_weight\_quant\_uvalue\_plane1,\ i);}
\DoxyCodeLine{00796\ }
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ error\ between\ the\ computed\ value\ and\ the\ ideal\ weight}}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ actual\_values1\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai1.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}\ +\ i);}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ diff\ =\ current\_values1\ -\/\ actual\_values1;}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error1\ =\ diff\ *\ diff\ *\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai1.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}\ +\ i);}
\DoxyCodeLine{00801\ }
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Plane\ 2}}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ bilinear\ interpolation\ of\ the\ decimated\ weight\ grid}}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ current\_values2\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45}{bilinear\_infill\_vla\_2}}(di,\ dec\_weight\_quant\_uvalue\_plane2,\ i);}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ error\ between\ the\ computed\ value\ and\ the\ ideal\ weight}}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ actual\_values2\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai2.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}\ +\ i);}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \ \ \ \ diff\ =\ current\_values2\ -\/\ actual\_values2;}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error2\ =\ diff\ *\ diff\ *\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai2.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}\ +\ i);}
\DoxyCodeLine{00810\ }
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aaa291a197219a09a2e1103aec6945b3c}{haccumulate}}(error\_summav,\ error1\ +\ error2);}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00813\ \ \ \ \ \}}
\DoxyCodeLine{00814\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00815\ \ \ \ \ \{}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Plane\ 1}}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Load\ the\ weight\ set\ directly,\ without\ interpolation}}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ current\_values1\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(dec\_weight\_quant\_uvalue\_plane1\ +\ i);}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ error\ between\ the\ computed\ value\ and\ the\ ideal\ weight}}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ actual\_values1\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai1.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}\ +\ i);}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ diff\ =\ current\_values1\ -\/\ actual\_values1;}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error1\ =\ diff\ *\ diff\ *\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai1.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}\ +\ i);}
\DoxyCodeLine{00826\ }
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Plane\ 2}}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Load\ the\ weight\ set\ directly,\ without\ interpolation}}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ current\_values2\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(dec\_weight\_quant\_uvalue\_plane2\ +\ i);}
\DoxyCodeLine{00830\ }
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ error\ between\ the\ computed\ value\ and\ the\ ideal\ weight}}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ actual\_values2\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai2.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}\ +\ i);}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \ \ \ \ diff\ =\ current\_values2\ -\/\ actual\_values2;}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error2\ =\ diff\ *\ diff\ *\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(eai2.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}\ +\ i);}
\DoxyCodeLine{00835\ }
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aaa291a197219a09a2e1103aec6945b3c}{haccumulate}}(error\_summav,\ error1\ +\ error2);}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00838\ \ \ \ \ \}}
\DoxyCodeLine{00839\ }
\DoxyCodeLine{00840\ \ \ \ \ \textcolor{comment}{//\ Resolve\ the\ final\ scalar\ accumulator\ sum}}
\DoxyCodeLine{00841\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(error\_summav);}
\DoxyCodeLine{00842\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a09a63c4b1e684f7ff9d88e5717b10bfb_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a09a63c4b1e684f7ff9d88e5717b10bfb_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_a3e9812129972c73914841ecc0f6a7e71}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_ideal\_colors\_and\_weights\_1\_comp@{compute\_ideal\_colors\_and\_weights\_1\_comp}}
\index{compute\_ideal\_colors\_and\_weights\_1\_comp@{compute\_ideal\_colors\_and\_weights\_1\_comp}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_ideal\_colors\_and\_weights\_1\_comp()}{compute\_ideal\_colors\_and\_weights\_1\_comp()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_a3e9812129972c73914841ecc0f6a7e71} 
static void compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+1\+\_\+comp (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&}]{blk}{, }\item[{const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&}]{pi}{, }\item[{\mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{ei}{, }\item[{unsigned int}]{component}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Compute the ideal endpoints and weights for 1 color component. 


\begin{DoxyParams}[1]{매개변수}
 & {\em blk} & The image block color data to compress. \\
\hline
 & {\em pi} & The partition info for the current trial. \\
\hline
\mbox{\texttt{ out}}  & {\em ei} & The computed ideal endpoints and weights. \\
\hline
 & {\em component} & The color component to compute. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00107}{107}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00112\ \ \ \{}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partition\_count\ =\ pi.\mbox{\hyperlink{structpartition__info_a1ffb0fdd4d560f536d6118f032fba4f3}{partition\_count}};}
\DoxyCodeLine{00114\ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a6815660d1584ae9e1fc4faebddf91658}{partition\_count}}\ =\ partition\_count;}
\DoxyCodeLine{00115\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(partition\_count\ >\ 0);}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\ =\ blk.\mbox{\hyperlink{structimage__block_a05174b1db0b9131ad61fc49f3aa74676}{texel\_count}};}
\DoxyCodeLine{00118\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(texel\_count\ >\ 0);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{float}\ error\_weight;}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}*\ data\_vr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ assert(component\ <\ \mbox{\hyperlink{astcenc__internal_8h_acfaa28ad6768cb0ebe7f535fc8a9e6df}{BLOCK\_MAX\_COMPONENTS}});}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordflow}{switch}\ (component)}
\DoxyCodeLine{00125\ \ \ \ \ \{}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordflow}{case}\ 0:}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ error\_weight\ =\ blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>();}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_acd4ea54654959c7b325efe9d02aaeacc}{data\_r}};}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ error\_weight\ =\ blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>();}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_abc5bc97aed6bb644726f952818ec74b5}{data\_g}};}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ error\_weight\ =\ blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>();}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_a298273079b0de525a0c12ced8bf98d13}{data\_b}};}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ assert(component\ ==\ 3);}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ error\_weight\ =\ blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<3>();}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_a602c8c88dc1ceef33e833f6d6cbc09ea}{data\_a}};}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00143\ \ \ \ \ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ sep\_mask\ =\ \mbox{\hyperlink{structvint4_a21e3d111e37da1aaaeb5ba21a831c863}{vint4::lane\_id}}()\ ==\ \mbox{\hyperlink{structvint4}{vint4}}(component);}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_constant\_wes\ \{\ \textcolor{keyword}{true}\ \};}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordtype}{float}\ partition0\_len\_sq\ \{\ 0.0f\ \};}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ partition\_count;\ i++)}
\DoxyCodeLine{00150\ \ \ \ \ \{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ lowvalue\ \{\ 1e10f\ \};}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ highvalue\ \{\ -\/1e10f\ \};}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partition\_texel\_count\ =\ pi.\mbox{\hyperlink{structpartition__info_a92b324c921407ee30e6052426e00e0f6}{partition\_texel\_count}}[i];}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ partition\_texel\_count;\ j++)}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tix\ =\ pi.\mbox{\hyperlink{structpartition__info_af0987713fff05a82c3230d9400c6e1e7}{texels\_of\_partition}}[i][j];}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ value\ =\ data\_vr[tix];}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ lowvalue\ =\ \mbox{\hyperlink{namespaceastc_af78c0d31374aa9923633a3a2abf8d738}{astc::min}}(value,\ lowvalue);}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ highvalue\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(value,\ highvalue);}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (highvalue\ <=\ lowvalue)}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ lowvalue\ =\ 0.0f;}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ highvalue\ =\ 1e-\/7f;}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ length\ =\ highvalue\ -\/\ lowvalue;}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ length\_squared\ =\ length\ *\ length;}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\ =\ 1.0f\ /\ length;}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ 0)}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ partition0\_len\_sq\ =\ length\_squared;}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ is\_constant\_wes\ =\ is\_constant\_wes\ \&\&\ length\_squared\ ==\ partition0\_len\_sq;}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ partition\_texel\_count;\ j++)}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tix\ =\ pi.\mbox{\hyperlink{structpartition__info_af0987713fff05a82c3230d9400c6e1e7}{texels\_of\_partition}}[i][j];}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ value\ =\ (data\_vr[tix]\ -\/\ lowvalue)\ *\ scale;}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ value\ =\ \mbox{\hyperlink{namespaceastc_ac60307af42a98d70a956170894e29e9e}{astc::clamp1f}}(value);}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[tix]\ =\ value;}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[tix]\ =\ length\_squared\ *\ error\_weight;}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ assert(!\mbox{\hyperlink{namespaceastc_aa80ae2eee0ffb5b754bdf0bb08b8759b}{astc::isnan}}(ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[tix]));}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(blk.\mbox{\hyperlink{structimage__block_a4222fc6e5a97194fd342700adff483db}{data\_min}},\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(lowvalue),\ sep\_mask);}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(blk.\mbox{\hyperlink{structimage__block_af1b03600b295cf8dc02a333db04871fc}{data\_max}},\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(highvalue),\ sep\_mask);}
\DoxyCodeLine{00195\ \ \ \ \ \}}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{comment}{//\ Zero\ initialize\ any\ SIMD\ over-\/fetch}}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\_simd\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_ae36622d837079b4899b971731c2dda37}{round\_up\_to\_simd\_multiple\_vla}}(texel\_count);}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ texel\_count;\ i\ <\ texel\_count\_simd;\ i++)}
\DoxyCodeLine{00200\ \ \ \ \ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[i]\ =\ 0.0f;}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[i]\ =\ 0.0f;}
\DoxyCodeLine{00203\ \ \ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a351e13ebfb998f06c4134c405cb5d0ec}{is\_constant\_weight\_error\_scale}}\ =\ is\_constant\_wes;}
\DoxyCodeLine{00206\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a3e9812129972c73914841ecc0f6a7e71_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a3e9812129972c73914841ecc0f6a7e71_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_afa8cab65d4b6f0cbece52eec38aed523}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_ideal\_colors\_and\_weights\_1plane@{compute\_ideal\_colors\_and\_weights\_1plane}}
\index{compute\_ideal\_colors\_and\_weights\_1plane@{compute\_ideal\_colors\_and\_weights\_1plane}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_ideal\_colors\_and\_weights\_1plane()}{compute\_ideal\_colors\_and\_weights\_1plane()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_afa8cab65d4b6f0cbece52eec38aed523} 
void compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+1plane (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&}]{blk}{, }\item[{const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&}]{pi}{, }\item[{\mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{ei}{}\end{DoxyParamCaption})}



Compute ideal endpoint colors and weights for 1 plane of weights. 

The ideal endpoints define a color line for the partition. For each texel the ideal weight defines an exact position on the partition color line. We can then use these to assess the error introduced by removing and quantizing the weight grid.


\begin{DoxyParams}[1]{매개변수}
 & {\em blk} & The image block color data to compress. \\
\hline
 & {\em pi} & The partition info for the current trial. \\
\hline
\mbox{\texttt{ out}}  & {\em ei} & The endpoint and weight values. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00612}{612}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00616\ \ \ \{}
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{keywordtype}{bool}\ uses\_alpha\ =\ !blk.\mbox{\hyperlink{structimage__block_ae3c0735355d378591db6cb7a011e381a}{is\_constant\_channel}}(3);}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \ \ \ \ \textcolor{keywordflow}{if}\ (uses\_alpha)}
\DoxyCodeLine{00620\ \ \ \ \ \{}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a08aebec57ada3441207dce6a7a02797e}{compute\_ideal\_colors\_and\_weights\_4\_comp}}(blk,\ pi,\ ei);}
\DoxyCodeLine{00622\ \ \ \ \ \}}
\DoxyCodeLine{00623\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00624\ \ \ \ \ \{}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a7ec20ff2556f6357cc0754c13e841262}{compute\_ideal\_colors\_and\_weights\_3\_comp}}(blk,\ pi,\ ei,\ 3);}
\DoxyCodeLine{00626\ \ \ \ \ \}}
\DoxyCodeLine{00627\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_afa8cab65d4b6f0cbece52eec38aed523_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_afa8cab65d4b6f0cbece52eec38aed523_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_ad96c399a873ddd142d4779b6aeb74b87}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_ideal\_colors\_and\_weights\_2\_comp@{compute\_ideal\_colors\_and\_weights\_2\_comp}}
\index{compute\_ideal\_colors\_and\_weights\_2\_comp@{compute\_ideal\_colors\_and\_weights\_2\_comp}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_ideal\_colors\_and\_weights\_2\_comp()}{compute\_ideal\_colors\_and\_weights\_2\_comp()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_ad96c399a873ddd142d4779b6aeb74b87} 
static void compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+2\+\_\+comp (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&}]{blk}{, }\item[{const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&}]{pi}{, }\item[{\mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{ei}{, }\item[{int}]{component1}{, }\item[{int}]{component2}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Compute the ideal endpoints and weights for 2 color components. 


\begin{DoxyParams}[1]{매개변수}
 & {\em blk} & The image block color data to compress. \\
\hline
 & {\em pi} & The partition info for the current trial. \\
\hline
\mbox{\texttt{ out}}  & {\em ei} & The computed ideal endpoints and weights. \\
\hline
 & {\em component1} & The first color component to compute. \\
\hline
 & {\em component2} & The second color component to compute. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00217}{217}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00223\ \ \ \{}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partition\_count\ =\ pi.\mbox{\hyperlink{structpartition__info_a1ffb0fdd4d560f536d6118f032fba4f3}{partition\_count}};}
\DoxyCodeLine{00225\ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a6815660d1584ae9e1fc4faebddf91658}{partition\_count}}\ =\ partition\_count;}
\DoxyCodeLine{00226\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(partition\_count\ >\ 0);}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\ =\ blk.\mbox{\hyperlink{structimage__block_a05174b1db0b9131ad61fc49f3aa74676}{texel\_count}};}
\DoxyCodeLine{00229\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(texel\_count\ >\ 0);}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \mbox{\hyperlink{structpartition__metrics}{partition\_metrics}}\ pms[\mbox{\hyperlink{astcenc__internal_8h_a31f42bb3da7abe95be4b6960feead130}{BLOCK\_MAX\_PARTITIONS}}];}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keywordtype}{float}\ error\_weight;}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}*\ data\_vr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}*\ data\_vg\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keywordflow}{if}\ (component1\ ==\ 0\ \&\&\ component2\ ==\ 1)}
\DoxyCodeLine{00238\ \ \ \ \ \{}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ error\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a0a3e390831722cc8e54f29155699f3a5}{swz}}<0,\ 1>())\ /\ 2.0f;}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_acd4ea54654959c7b325efe9d02aaeacc}{data\_r}};}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ data\_vg\ =\ blk.\mbox{\hyperlink{structimage__block_abc5bc97aed6bb644726f952818ec74b5}{data\_g}};}
\DoxyCodeLine{00243\ \ \ \ \ \}}
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (component1\ ==\ 0\ \&\&\ component2\ ==\ 2)}
\DoxyCodeLine{00245\ \ \ \ \ \{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ error\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a0a3e390831722cc8e54f29155699f3a5}{swz}}<0,\ 2>())\ /\ 2.0f;}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_acd4ea54654959c7b325efe9d02aaeacc}{data\_r}};}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ data\_vg\ =\ blk.\mbox{\hyperlink{structimage__block_a298273079b0de525a0c12ced8bf98d13}{data\_b}};}
\DoxyCodeLine{00250\ \ \ \ \ \}}
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ (component1\ ==\ 1\ \&\&\ component2\ ==\ 2)}}
\DoxyCodeLine{00252\ \ \ \ \ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ assert(component1\ ==\ 1\ \&\&\ component2\ ==\ 2);}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ error\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a0a3e390831722cc8e54f29155699f3a5}{swz}}<1,\ 2>())\ /\ 2.0f;}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_abc5bc97aed6bb644726f952818ec74b5}{data\_g}};}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ data\_vg\ =\ blk.\mbox{\hyperlink{structimage__block_a298273079b0de525a0c12ced8bf98d13}{data\_b}};}
\DoxyCodeLine{00259\ \ \ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \mbox{\hyperlink{astcenc__averages__and__directions_8cpp_a63e55f3f2ec6932357b8387f3dd82f7a}{compute\_avgs\_and\_dirs\_2\_comp}}(pi,\ blk,\ component1,\ component2,\ pms);}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_constant\_wes\ \{\ \textcolor{keyword}{true}\ \};}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordtype}{float}\ partition0\_len\_sq\ \{\ 0.0f\ \};}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ comp1\_mask\ =\ \mbox{\hyperlink{structvint4_a21e3d111e37da1aaaeb5ba21a831c863}{vint4::lane\_id}}()\ ==\ \mbox{\hyperlink{structvint4}{vint4}}(component1);}
\DoxyCodeLine{00267\ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ comp2\_mask\ =\ \mbox{\hyperlink{structvint4_a21e3d111e37da1aaaeb5ba21a831c863}{vint4::lane\_id}}()\ ==\ \mbox{\hyperlink{structvint4}{vint4}}(component2);}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ partition\_count;\ i++)}
\DoxyCodeLine{00270\ \ \ \ \ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ dir\ =\ pms[i].\mbox{\hyperlink{structpartition__metrics_a5a05f959255774e848e83001f9b7bd37}{dir}};}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(dir)\ <\ 0.0f)}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ dir\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat4::zero}}()\ -\/\ dir;}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structline2}{line2}}\ line\ \{\ pms[i].\mbox{\hyperlink{structpartition__metrics_a81851ed35dd9dc3ce09a74b8167f5846}{avg}},\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a3b0e8ae23a514219217b72164a7909a4}{normalize\_safe}}(dir,\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a7570a31cd88cd3cdb3e6a46da056f3d3}{unit2}}())\ \};}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ lowparam\ \{\ 1e10f\ \};}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ highparam\ \{\ -\/1e10f\ \};}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partition\_texel\_count\ =\ pi.\mbox{\hyperlink{structpartition__info_a92b324c921407ee30e6052426e00e0f6}{partition\_texel\_count}}[i];}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ partition\_texel\_count;\ j++)}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tix\ =\ pi.\mbox{\hyperlink{structpartition__info_af0987713fff05a82c3230d9400c6e1e7}{texels\_of\_partition}}[i][j];}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ point\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a4750532a1dbacf2063927a027725afde}{vfloat2}}(data\_vr[tix],\ data\_vg[tix]);}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ param\ =\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a53a7d8285fd42b50cf3600a004db34ac}{dot\_s}}(point\ -\/\ line.a,\ line.b);}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[tix]\ =\ param;}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ lowparam\ =\ \mbox{\hyperlink{namespaceastc_af78c0d31374aa9923633a3a2abf8d738}{astc::min}}(param,\ lowparam);}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ highparam\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(param,\ highparam);}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ is\ possible\ for\ a\ uniform-\/color\ partition\ to\ produce\ length=0;}}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ causes\ NaN\ issues\ so\ set\ to\ small\ value\ to\ avoid\ this\ problem}}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (highparam\ <=\ lowparam)}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ lowparam\ =\ 0.0f;}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ highparam\ =\ 1e-\/7f;}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ length\ =\ highparam\ -\/\ lowparam;}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ length\_squared\ =\ length\ *\ length;}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\ =\ 1.0f\ /\ length;}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ 0)}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ partition0\_len\_sq\ =\ length\_squared;}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ is\_constant\_wes\ =\ is\_constant\_wes\ \&\&\ length\_squared\ ==\ partition0\_len\_sq;}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ partition\_texel\_count;\ j++)}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tix\ =\ pi.\mbox{\hyperlink{structpartition__info_af0987713fff05a82c3230d9400c6e1e7}{texels\_of\_partition}}[i][j];}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ idx\ =\ (ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[tix]\ -\/\ lowparam)\ *\ scale;}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ idx\ =\ \mbox{\hyperlink{namespaceastc_ac60307af42a98d70a956170894e29e9e}{astc::clamp1f}}(idx);}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[tix]\ =\ idx;}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[tix]\ =\ length\_squared\ *\ error\_weight;}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ assert(!\mbox{\hyperlink{namespaceastc_aa80ae2eee0ffb5b754bdf0bb08b8759b}{astc::isnan}}(ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[tix]));}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ lowvalue\ =\ line.a\ +\ line.b\ *\ lowparam;}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ highvalue\ =\ line.a\ +\ line.b\ *\ highparam;}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep0\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(blk.\mbox{\hyperlink{structimage__block_a4222fc6e5a97194fd342700adff483db}{data\_min}},\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(lowvalue.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>()),\ comp1\_mask);}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep1\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(blk.\mbox{\hyperlink{structimage__block_af1b03600b295cf8dc02a333db04871fc}{data\_max}},\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(highvalue.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>()),\ comp1\_mask);}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep0,\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(lowvalue.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()),\ comp2\_mask);}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep1,\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(highvalue.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()),\ comp2\_mask);}
\DoxyCodeLine{00333\ \ \ \ \ \}}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{comment}{//\ Zero\ initialize\ any\ SIMD\ over-\/fetch}}
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\_simd\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_ae36622d837079b4899b971731c2dda37}{round\_up\_to\_simd\_multiple\_vla}}(texel\_count);}
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ texel\_count;\ i\ <\ texel\_count\_simd;\ i++)}
\DoxyCodeLine{00338\ \ \ \ \ \{}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[i]\ =\ 0.0f;}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[i]\ =\ 0.0f;}
\DoxyCodeLine{00341\ \ \ \ \ \}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a351e13ebfb998f06c4134c405cb5d0ec}{is\_constant\_weight\_error\_scale}}\ =\ is\_constant\_wes;}
\DoxyCodeLine{00344\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_ad96c399a873ddd142d4779b6aeb74b87_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_ad96c399a873ddd142d4779b6aeb74b87_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_a52d3985007cfc83025661e0347bc00cc}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_ideal\_colors\_and\_weights\_2planes@{compute\_ideal\_colors\_and\_weights\_2planes}}
\index{compute\_ideal\_colors\_and\_weights\_2planes@{compute\_ideal\_colors\_and\_weights\_2planes}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_ideal\_colors\_and\_weights\_2planes()}{compute\_ideal\_colors\_and\_weights\_2planes()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_a52d3985007cfc83025661e0347bc00cc} 
void compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+2planes (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structblock__size__descriptor}{block\+\_\+size\+\_\+descriptor}} \&}]{bsd}{, }\item[{const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&}]{blk}{, }\item[{unsigned int}]{plane2\+\_\+component}{, }\item[{\mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{ei1}{, }\item[{\mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{ei2}{}\end{DoxyParamCaption})}



Compute ideal endpoint colors and weights for 2 planes of weights. 

The ideal endpoints define a color line for the partition. For each texel the ideal weight defines an exact position on the partition color line. We can then use these to assess the error introduced by removing and quantizing the weight grid.


\begin{DoxyParams}[1]{매개변수}
 & {\em bsd} & The block size information. \\
\hline
 & {\em blk} & The image block color data to compress. \\
\hline
 & {\em plane2\+\_\+component} & The component assigned to plane 2. \\
\hline
\mbox{\texttt{ out}}  & {\em ei1} & The endpoint and weight values for plane 1. \\
\hline
\mbox{\texttt{ out}}  & {\em ei2} & The endpoint and weight values for plane 2. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00630}{630}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00636\ \ \ \{}
\DoxyCodeLine{00637\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pi\ =\ bsd.\mbox{\hyperlink{structblock__size__descriptor_aa9dfc7b23c8b5e6c71e956e2e39fff74}{get\_partition\_info}}(1,\ 0);}
\DoxyCodeLine{00638\ \ \ \ \ \textcolor{keywordtype}{bool}\ uses\_alpha\ =\ !blk.\mbox{\hyperlink{structimage__block_ae3c0735355d378591db6cb7a011e381a}{is\_constant\_channel}}(3);}
\DoxyCodeLine{00639\ }
\DoxyCodeLine{00640\ \ \ \ \ assert(plane2\_component\ <\ \mbox{\hyperlink{astcenc__internal_8h_acfaa28ad6768cb0ebe7f535fc8a9e6df}{BLOCK\_MAX\_COMPONENTS}});}
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keywordflow}{switch}\ (plane2\_component)}
\DoxyCodeLine{00642\ \ \ \ \ \{}
\DoxyCodeLine{00643\ \ \ \ \ \textcolor{keywordflow}{case}\ 0:\ \textcolor{comment}{//\ Separate\ weights\ for\ red}}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uses\_alpha)}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a7ec20ff2556f6357cc0754c13e841262}{compute\_ideal\_colors\_and\_weights\_3\_comp}}(blk,\ pi,\ ei1,\ 0);}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_ad96c399a873ddd142d4779b6aeb74b87}{compute\_ideal\_colors\_and\_weights\_2\_comp}}(blk,\ pi,\ ei1,\ 1,\ 2);}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a3e9812129972c73914841ecc0f6a7e71}{compute\_ideal\_colors\_and\_weights\_1\_comp}}(blk,\ pi,\ ei2,\ 0);}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \ \ \ \ \textcolor{keywordflow}{case}\ 1:\ \textcolor{comment}{//\ Separate\ weights\ for\ green}}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uses\_alpha)}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a7ec20ff2556f6357cc0754c13e841262}{compute\_ideal\_colors\_and\_weights\_3\_comp}}(blk,\ pi,\ ei1,\ 1);}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_ad96c399a873ddd142d4779b6aeb74b87}{compute\_ideal\_colors\_and\_weights\_2\_comp}}(blk,\ pi,\ ei1,\ 0,\ 2);}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a3e9812129972c73914841ecc0f6a7e71}{compute\_ideal\_colors\_and\_weights\_1\_comp}}(blk,\ pi,\ ei2,\ 1);}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00666\ }
\DoxyCodeLine{00667\ \ \ \ \ \textcolor{keywordflow}{case}\ 2:\ \textcolor{comment}{//\ Separate\ weights\ for\ blue}}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uses\_alpha)}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a7ec20ff2556f6357cc0754c13e841262}{compute\_ideal\_colors\_and\_weights\_3\_comp}}(blk,\ pi,\ ei1,\ 2);}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_ad96c399a873ddd142d4779b6aeb74b87}{compute\_ideal\_colors\_and\_weights\_2\_comp}}(blk,\ pi,\ ei1,\ 0,\ 1);}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a3e9812129972c73914841ecc0f6a7e71}{compute\_ideal\_colors\_and\_weights\_1\_comp}}(blk,\ pi,\ ei2,\ 2);}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00678\ }
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{keywordflow}{default}:\ \textcolor{comment}{//\ Separate\ weights\ for\ alpha}}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ assert(uses\_alpha);}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a7ec20ff2556f6357cc0754c13e841262}{compute\_ideal\_colors\_and\_weights\_3\_comp}}(blk,\ pi,\ ei1,\ 3);}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a3e9812129972c73914841ecc0f6a7e71}{compute\_ideal\_colors\_and\_weights\_1\_comp}}(blk,\ pi,\ ei2,\ 3);}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00684\ \ \ \ \ \}}
\DoxyCodeLine{00685\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a52d3985007cfc83025661e0347bc00cc_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a52d3985007cfc83025661e0347bc00cc_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_a7ec20ff2556f6357cc0754c13e841262}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_ideal\_colors\_and\_weights\_3\_comp@{compute\_ideal\_colors\_and\_weights\_3\_comp}}
\index{compute\_ideal\_colors\_and\_weights\_3\_comp@{compute\_ideal\_colors\_and\_weights\_3\_comp}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_ideal\_colors\_and\_weights\_3\_comp()}{compute\_ideal\_colors\_and\_weights\_3\_comp()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_a7ec20ff2556f6357cc0754c13e841262} 
static void compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+3\+\_\+comp (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&}]{blk}{, }\item[{const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&}]{pi}{, }\item[{\mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{ei}{, }\item[{unsigned int}]{omitted\+\_\+component}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Compute the ideal endpoints and weights for 3 color components. 


\begin{DoxyParams}[1]{매개변수}
 & {\em blk} & The image block color data to compress. \\
\hline
 & {\em pi} & The partition info for the current trial. \\
\hline
\mbox{\texttt{ out}}  & {\em ei} & The computed ideal endpoints and weights. \\
\hline
 & {\em omitted\+\_\+component} & The color component excluded from the calculation. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00354}{354}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00359\ \ \ \{}
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partition\_count\ =\ pi.\mbox{\hyperlink{structpartition__info_a1ffb0fdd4d560f536d6118f032fba4f3}{partition\_count}};}
\DoxyCodeLine{00361\ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a6815660d1584ae9e1fc4faebddf91658}{partition\_count}}\ =\ partition\_count;}
\DoxyCodeLine{00362\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(partition\_count\ >\ 0);}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\ =\ blk.\mbox{\hyperlink{structimage__block_a05174b1db0b9131ad61fc49f3aa74676}{texel\_count}};}
\DoxyCodeLine{00365\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(texel\_count\ >\ 0);}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \ \ \mbox{\hyperlink{structpartition__metrics}{partition\_metrics}}\ pms[\mbox{\hyperlink{astcenc__internal_8h_a31f42bb3da7abe95be4b6960feead130}{BLOCK\_MAX\_PARTITIONS}}];}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{keywordtype}{float}\ error\_weight;}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}*\ data\_vr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}*\ data\_vg\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}*\ data\_vb\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keywordflow}{if}\ (omitted\_component\ ==\ 0)}
\DoxyCodeLine{00374\ \ \ \ \ \{}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ error\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a0a3e390831722cc8e54f29155699f3a5}{swz}}<0,\ 1,\ 2>());}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_abc5bc97aed6bb644726f952818ec74b5}{data\_g}};}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ data\_vg\ =\ blk.\mbox{\hyperlink{structimage__block_a298273079b0de525a0c12ced8bf98d13}{data\_b}};}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ data\_vb\ =\ blk.\mbox{\hyperlink{structimage__block_a602c8c88dc1ceef33e833f6d6cbc09ea}{data\_a}};}
\DoxyCodeLine{00379\ \ \ \ \ \}}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (omitted\_component\ ==\ 1)}
\DoxyCodeLine{00381\ \ \ \ \ \{}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ error\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a0a3e390831722cc8e54f29155699f3a5}{swz}}<0,\ 2,\ 3>());}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_acd4ea54654959c7b325efe9d02aaeacc}{data\_r}};}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ data\_vg\ =\ blk.\mbox{\hyperlink{structimage__block_a298273079b0de525a0c12ced8bf98d13}{data\_b}};}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ data\_vb\ =\ blk.\mbox{\hyperlink{structimage__block_a602c8c88dc1ceef33e833f6d6cbc09ea}{data\_a}};}
\DoxyCodeLine{00386\ \ \ \ \ \}}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (omitted\_component\ ==\ 2)}
\DoxyCodeLine{00388\ \ \ \ \ \{}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ error\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a0a3e390831722cc8e54f29155699f3a5}{swz}}<0,\ 1,\ 3>());}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_acd4ea54654959c7b325efe9d02aaeacc}{data\_r}};}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ data\_vg\ =\ blk.\mbox{\hyperlink{structimage__block_abc5bc97aed6bb644726f952818ec74b5}{data\_g}};}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ data\_vb\ =\ blk.\mbox{\hyperlink{structimage__block_a602c8c88dc1ceef33e833f6d6cbc09ea}{data\_a}};}
\DoxyCodeLine{00393\ \ \ \ \ \}}
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00395\ \ \ \ \ \{}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ assert(omitted\_component\ ==\ 3);}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ error\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}.\mbox{\hyperlink{structvfloat4_a0a3e390831722cc8e54f29155699f3a5}{swz}}<0,\ 1,\ 2>());}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ data\_vr\ =\ blk.\mbox{\hyperlink{structimage__block_acd4ea54654959c7b325efe9d02aaeacc}{data\_r}};}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ data\_vg\ =\ blk.\mbox{\hyperlink{structimage__block_abc5bc97aed6bb644726f952818ec74b5}{data\_g}};}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ data\_vb\ =\ blk.\mbox{\hyperlink{structimage__block_a298273079b0de525a0c12ced8bf98d13}{data\_b}};}
\DoxyCodeLine{00402\ \ \ \ \ \}}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \ \ error\_weight\ =\ error\_weight\ *\ (1.0f\ /\ 3.0f);}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keywordflow}{if}\ (omitted\_component\ ==\ 3)}
\DoxyCodeLine{00407\ \ \ \ \ \{}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__averages__and__directions_8cpp_a73936e5cf41b74f2b8d9b137a9d64253}{compute\_avgs\_and\_dirs\_3\_comp\_rgb}}(pi,\ blk,\ pms);}
\DoxyCodeLine{00409\ \ \ \ \ \}}
\DoxyCodeLine{00410\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00411\ \ \ \ \ \{}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__averages__and__directions_8cpp_a33f923c5a839af4f1d369a391183c384}{compute\_avgs\_and\_dirs\_3\_comp}}(pi,\ blk,\ omitted\_component,\ pms);}
\DoxyCodeLine{00413\ \ \ \ \ \}}
\DoxyCodeLine{00414\ }
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_constant\_wes\ \{\ \textcolor{keyword}{true}\ \};}
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordtype}{float}\ partition0\_len\_sq\ \{\ 0.0f\ \};}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ partition\_count;\ i++)}
\DoxyCodeLine{00419\ \ \ \ \ \{}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ dir\ =\ pms[i].\mbox{\hyperlink{structpartition__metrics_a5a05f959255774e848e83001f9b7bd37}{dir}};}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a48e833d0cfdf950b6bc3431fce00507e}{hadd\_rgb\_s}}(dir)\ <\ 0.0f)}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ dir\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat4::zero}}()\ -\/\ dir;}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structline3}{line3}}\ line\ \{\ pms[i].\mbox{\hyperlink{structpartition__metrics_a81851ed35dd9dc3ce09a74b8167f5846}{avg}},\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a3b0e8ae23a514219217b72164a7909a4}{normalize\_safe}}(dir,\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a3cf3e0218d808e69f31668dbc458dc08}{unit3}}())\ \};}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ lowparam\ \{\ 1e10f\ \};}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ highparam\ \{\ -\/1e10f\ \};}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partition\_texel\_count\ =\ pi.\mbox{\hyperlink{structpartition__info_a92b324c921407ee30e6052426e00e0f6}{partition\_texel\_count}}[i];}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ partition\_texel\_count;\ j++)}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tix\ =\ pi.\mbox{\hyperlink{structpartition__info_af0987713fff05a82c3230d9400c6e1e7}{texels\_of\_partition}}[i][j];}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ point\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1a2e12d78738b0b4b550f57b2dc05f07}{vfloat3}}(data\_vr[tix],\ data\_vg[tix],\ data\_vb[tix]);}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ param\ =\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a377cafdb98d3ee38a2999ed00504f477}{dot3\_s}}(point\ -\/\ line.a,\ line.b);}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[tix]\ =\ param;}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ lowparam\ =\ \mbox{\hyperlink{namespaceastc_af78c0d31374aa9923633a3a2abf8d738}{astc::min}}(param,\ lowparam);}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ highparam\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(param,\ highparam);}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ is\ possible\ for\ a\ uniform-\/color\ partition\ to\ produce\ length=0;}}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ causes\ NaN\ issues\ so\ set\ to\ small\ value\ to\ avoid\ this\ problem}}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (highparam\ <=\ lowparam)}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ lowparam\ =\ 0.0f;}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ highparam\ =\ 1e-\/7f;}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ length\ =\ highparam\ -\/\ lowparam;}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ length\_squared\ =\ length\ *\ length;}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\ =\ 1.0f\ /\ length;}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ 0)}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ partition0\_len\_sq\ =\ length\_squared;}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ is\_constant\_wes\ =\ is\_constant\_wes\ \&\&\ length\_squared\ ==\ partition0\_len\_sq;}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ partition\_texel\_count;\ j++)}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tix\ =\ pi.\mbox{\hyperlink{structpartition__info_af0987713fff05a82c3230d9400c6e1e7}{texels\_of\_partition}}[i][j];}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ idx\ =\ (ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[tix]\ -\/\ lowparam)\ *\ scale;}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ idx\ =\ \mbox{\hyperlink{namespaceastc_ac60307af42a98d70a956170894e29e9e}{astc::clamp1f}}(idx);}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[tix]\ =\ idx;}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[tix]\ =\ length\_squared\ *\ error\_weight;}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ assert(!\mbox{\hyperlink{namespaceastc_aa80ae2eee0ffb5b754bdf0bb08b8759b}{astc::isnan}}(ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[tix]));}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep0\ =\ line.a\ +\ line.b\ *\ lowparam;}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep1\ =\ line.a\ +\ line.b\ *\ highparam;}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ bmin\ =\ blk.\mbox{\hyperlink{structimage__block_a4222fc6e5a97194fd342700adff483db}{data\_min}};}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ bmax\ =\ blk.\mbox{\hyperlink{structimage__block_af1b03600b295cf8dc02a333db04871fc}{data\_max}};}
\DoxyCodeLine{00479\ }
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ assert(omitted\_component\ <\ \mbox{\hyperlink{astcenc__internal_8h_acfaa28ad6768cb0ebe7f535fc8a9e6df}{BLOCK\_MAX\_COMPONENTS}});}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (omitted\_component)}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0:}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(bmin.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>());}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(bmax.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>());}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ bmin.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>());}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ bmax.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>());}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ bmin.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>());}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ bmax.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>());}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ bmin.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<3>());}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ ep1.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ bmax.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<3>());}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00500\ \ \ \ \ \}}
\DoxyCodeLine{00501\ }
\DoxyCodeLine{00502\ \ \ \ \ \textcolor{comment}{//\ Zero\ initialize\ any\ SIMD\ over-\/fetch}}
\DoxyCodeLine{00503\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\_simd\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_ae36622d837079b4899b971731c2dda37}{round\_up\_to\_simd\_multiple\_vla}}(texel\_count);}
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ texel\_count;\ i\ <\ texel\_count\_simd;\ i++)}
\DoxyCodeLine{00505\ \ \ \ \ \{}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[i]\ =\ 0.0f;}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[i]\ =\ 0.0f;}
\DoxyCodeLine{00508\ \ \ \ \ \}}
\DoxyCodeLine{00509\ }
\DoxyCodeLine{00510\ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a351e13ebfb998f06c4134c405cb5d0ec}{is\_constant\_weight\_error\_scale}}\ =\ is\_constant\_wes;}
\DoxyCodeLine{00511\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a7ec20ff2556f6357cc0754c13e841262_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a7ec20ff2556f6357cc0754c13e841262_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_a08aebec57ada3441207dce6a7a02797e}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_ideal\_colors\_and\_weights\_4\_comp@{compute\_ideal\_colors\_and\_weights\_4\_comp}}
\index{compute\_ideal\_colors\_and\_weights\_4\_comp@{compute\_ideal\_colors\_and\_weights\_4\_comp}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_ideal\_colors\_and\_weights\_4\_comp()}{compute\_ideal\_colors\_and\_weights\_4\_comp()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_a08aebec57ada3441207dce6a7a02797e} 
static void compute\+\_\+ideal\+\_\+colors\+\_\+and\+\_\+weights\+\_\+4\+\_\+comp (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&}]{blk}{, }\item[{const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&}]{pi}{, }\item[{\mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{ei}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Compute the ideal endpoints and weights for 4 color components. 


\begin{DoxyParams}[1]{매개변수}
 & {\em blk} & The image block color data to compress. \\
\hline
 & {\em pi} & The partition info for the current trial. \\
\hline
\mbox{\texttt{ out}}  & {\em ei} & The computed ideal endpoints and weights. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00520}{520}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00524\ \ \ \{}
\DoxyCodeLine{00525\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ error\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aacd26478e4fe1f97a5d47e8adaacc898}{hadd\_s}}(blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}})\ /\ 4.0f;}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partition\_count\ =\ pi.\mbox{\hyperlink{structpartition__info_a1ffb0fdd4d560f536d6118f032fba4f3}{partition\_count}};}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00529\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\ =\ blk.\mbox{\hyperlink{structimage__block_a05174b1db0b9131ad61fc49f3aa74676}{texel\_count}};}
\DoxyCodeLine{00530\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(texel\_count\ >\ 0);}
\DoxyCodeLine{00531\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(partition\_count\ >\ 0);}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ \ \ \mbox{\hyperlink{structpartition__metrics}{partition\_metrics}}\ pms[\mbox{\hyperlink{astcenc__internal_8h_a31f42bb3da7abe95be4b6960feead130}{BLOCK\_MAX\_PARTITIONS}}];}
\DoxyCodeLine{00534\ }
\DoxyCodeLine{00535\ \ \ \ \ \mbox{\hyperlink{astcenc__averages__and__directions_8cpp_a00407861c2f0e767b64b1cb1bb7a27b6}{compute\_avgs\_and\_dirs\_4\_comp}}(pi,\ blk,\ pms);}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_constant\_wes\ \{\ \textcolor{keyword}{true}\ \};}
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{keywordtype}{float}\ partition0\_len\_sq\ \{\ 0.0f\ \};}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ partition\_count;\ i++)}
\DoxyCodeLine{00541\ \ \ \ \ \{}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ dir\ =\ pms[i].\mbox{\hyperlink{structpartition__metrics_a5a05f959255774e848e83001f9b7bd37}{dir}};}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a48e833d0cfdf950b6bc3431fce00507e}{hadd\_rgb\_s}}(dir)\ <\ 0.0f)}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \ dir\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat4::zero}}()\ -\/\ dir;}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structline4}{line4}}\ line\ \{\ pms[i].\mbox{\hyperlink{structpartition__metrics_a81851ed35dd9dc3ce09a74b8167f5846}{avg}},\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a3b0e8ae23a514219217b72164a7909a4}{normalize\_safe}}(dir,\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a5177e2c50f2c01a5610b2844ee3a071d}{unit4}}())\ \};}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ lowparam\ \{\ 1e10f\ \};}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ highparam\ \{\ -\/1e10f\ \};}
\DoxyCodeLine{00551\ }
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partition\_texel\_count\ =\ pi.\mbox{\hyperlink{structpartition__info_a92b324c921407ee30e6052426e00e0f6}{partition\_texel\_count}}[i];}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ partition\_texel\_count;\ j++)}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tix\ =\ pi.\mbox{\hyperlink{structpartition__info_af0987713fff05a82c3230d9400c6e1e7}{texels\_of\_partition}}[i][j];}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ point\ =\ blk.\mbox{\hyperlink{structimage__block_af99de7d75e1e380b31d70d131509caa9}{texel}}(tix);}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ param\ =\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a53a7d8285fd42b50cf3600a004db34ac}{dot\_s}}(point\ -\/\ line.a,\ line.b);}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[tix]\ =\ param;}
\DoxyCodeLine{00559\ }
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ lowparam\ =\ \mbox{\hyperlink{namespaceastc_af78c0d31374aa9923633a3a2abf8d738}{astc::min}}(param,\ lowparam);}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ highparam\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(param,\ highparam);}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00563\ }
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ is\ possible\ for\ a\ uniform-\/color\ partition\ to\ produce\ length=0;}}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ causes\ NaN\ issues\ so\ set\ to\ small\ value\ to\ avoid\ this\ problem}}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (highparam\ <=\ lowparam)}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ lowparam\ =\ 0.0f;}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ highparam\ =\ 1e-\/7f;}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ length\ =\ highparam\ -\/\ lowparam;}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ length\_squared\ =\ length\ *\ length;}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\ =\ 1.0f\ /\ length;}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ 0)}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ \ partition0\_len\_sq\ =\ length\_squared;}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \ \ \ \ is\_constant\_wes\ =\ is\_constant\_wes\ \&\&\ length\_squared\ ==\ partition0\_len\_sq;}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00584\ }
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i]\ =\ line.a\ +\ line.b\ *\ lowparam;}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a9b5a8f6a4d2bdbf5993eeba5593228c4}{ep}}.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i]\ =\ line.a\ +\ line.b\ *\ highparam;}
\DoxyCodeLine{00587\ }
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ partition\_texel\_count;\ j++)}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tix\ =\ pi.\mbox{\hyperlink{structpartition__info_af0987713fff05a82c3230d9400c6e1e7}{texels\_of\_partition}}[i][j];}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ idx\ =\ (ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[tix]\ -\/\ lowparam)\ *\ scale;}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ idx\ =\ \mbox{\hyperlink{namespaceastc_ac60307af42a98d70a956170894e29e9e}{astc::clamp1f}}(idx);}
\DoxyCodeLine{00593\ }
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[tix]\ =\ idx;}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[tix]\ =\ length\_squared\ *\ error\_weight;}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \ \ \ \ assert(!\mbox{\hyperlink{namespaceastc_aa80ae2eee0ffb5b754bdf0bb08b8759b}{astc::isnan}}(ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[tix]));}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00598\ \ \ \ \ \}}
\DoxyCodeLine{00599\ }
\DoxyCodeLine{00600\ \ \ \ \ \textcolor{comment}{//\ Zero\ initialize\ any\ SIMD\ over-\/fetch}}
\DoxyCodeLine{00601\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\_simd\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_ae36622d837079b4899b971731c2dda37}{round\_up\_to\_simd\_multiple\_vla}}(texel\_count);}
\DoxyCodeLine{00602\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ texel\_count;\ i\ <\ texel\_count\_simd;\ i++)}
\DoxyCodeLine{00603\ \ \ \ \ \{}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}[i]\ =\ 0.0f;}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[i]\ =\ 0.0f;}
\DoxyCodeLine{00606\ \ \ \ \ \}}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \ \ \ \ ei.\mbox{\hyperlink{structendpoints__and__weights_a351e13ebfb998f06c4134c405cb5d0ec}{is\_constant\_weight\_error\_scale}}\ =\ is\_constant\_wes;}
\DoxyCodeLine{00609\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a08aebec57ada3441207dce6a7a02797e_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a08aebec57ada3441207dce6a7a02797e_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_ae1b4e922c67d5349fc849709ca08178f}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_ideal\_weights\_for\_decimation@{compute\_ideal\_weights\_for\_decimation}}
\index{compute\_ideal\_weights\_for\_decimation@{compute\_ideal\_weights\_for\_decimation}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_ideal\_weights\_for\_decimation()}{compute\_ideal\_weights\_for\_decimation()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_ae1b4e922c67d5349fc849709ca08178f} 
void compute\+\_\+ideal\+\_\+weights\+\_\+for\+\_\+decimation (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structendpoints__and__weights}{endpoints\+\_\+and\+\_\+weights}} \&}]{ei}{, }\item[{const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&}]{di}{, }\item[{float \texorpdfstring{$\ast$}{*}}]{dec\+\_\+weight\+\_\+ideal\+\_\+value}{}\end{DoxyParamCaption})}



Compute the optimal unquantized weights for a decimation table. 

After computing ideal weights for the case for a complete weight grid, we we want to compute the ideal weights for the case where weights exist only for some texels. We do this with a steepest-\/descent grid solver which works as follows\+:

First, for each actual weight, perform a weighted averaging of the texels affected by the weight. Then, set step size to $<$some initial value$>$ and attempt one step towards the original ideal weight if it helps to reduce error.


\begin{DoxyParams}[1]{매개변수}
 & {\em ei} & The non-\/decimated endpoints and weights. \\
\hline
 & {\em di} & The selected weight decimation. \\
\hline
\mbox{\texttt{ out}}  & {\em dec\+\_\+weight\+\_\+ideal\+\_\+value} & The ideal values for the decimated weight set. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00845}{845}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00849\ \ \ \{}
\DoxyCodeLine{00850\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\ =\ di.\mbox{\hyperlink{structdecimation__info_a2f6c6f84342c82092324c05035b3c9c1}{texel\_count}};}
\DoxyCodeLine{00851\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ weight\_count\ =\ di.\mbox{\hyperlink{structdecimation__info_af7d0c86be805995a20a6c09f6c3ab8ca}{weight\_count}};}
\DoxyCodeLine{00852\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_direct\ =\ texel\_count\ ==\ weight\_count;}
\DoxyCodeLine{00853\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(texel\_count\ >\ 0);}
\DoxyCodeLine{00854\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(weight\_count\ >\ 0);}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00856\ \ \ \ \ \textcolor{comment}{//\ Ensure\ that\ the\ end\ of\ the\ output\ arrays\ that\ are\ used\ for\ SIMD\ paths\ later\ are\ filled\ so\ we}}
\DoxyCodeLine{00857\ \ \ \ \ \textcolor{comment}{//\ can\ safely\ run\ SIMD\ elsewhere\ without\ a\ loop\ tail.\ Note\ that\ this\ is\ always\ safe\ as\ weight}}
\DoxyCodeLine{00858\ \ \ \ \ \textcolor{comment}{//\ arrays\ always\ contain\ space\ for\ 64\ elements}}
\DoxyCodeLine{00859\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ prev\_weight\_count\_simd\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a63b1ecd0244123ff734e6791e33bf9ca}{round\_down\_to\_simd\_multiple\_vla}}(weight\_count\ -\/\ 1);}
\DoxyCodeLine{00860\ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(\mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat::zero}}(),\ dec\_weight\_ideal\_value\ +\ prev\_weight\_count\_simd);}
\DoxyCodeLine{00861\ }
\DoxyCodeLine{00862\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ 1:1\ mapping\ just\ shortcut\ the\ computation.\ Transfer\ enough\ to\ also\ copy\ the}}
\DoxyCodeLine{00863\ \ \ \ \ \textcolor{comment}{//\ zero-\/initialized\ SIMD\ over-\/fetch\ region}}
\DoxyCodeLine{00864\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_direct)}
\DoxyCodeLine{00865\ \ \ \ \ \{}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight(ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}}\ +\ i);}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(weight,\ dec\_weight\_ideal\_value\ +\ i);}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00871\ }
\DoxyCodeLine{00872\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00873\ \ \ \ \ \}}
\DoxyCodeLine{00874\ }
\DoxyCodeLine{00875\ \ \ \ \ \textcolor{comment}{//\ Otherwise\ compute\ an\ estimate\ and\ perform\ single\ refinement\ iteration}}
\DoxyCodeLine{00876\ \ \ \ \ \mbox{\hyperlink{astcenc__mathlib_8h_adf60643d2894fb1d3cd00d4f907186e8}{ASTCENC\_ALIGNAS}}\ \textcolor{keywordtype}{float}\ infilled\_weights[\mbox{\hyperlink{astcenc__internal_8h_ad694a8ff82a68a50b11bac439531241e}{BLOCK\_MAX\_TEXELS}}];}
\DoxyCodeLine{00877\ }
\DoxyCodeLine{00878\ \ \ \ \ \textcolor{comment}{//\ Compute\ an\ initial\ average\ for\ each\ decimated\ weight}}
\DoxyCodeLine{00879\ \ \ \ \ \textcolor{keywordtype}{bool}\ constant\_wes\ =\ ei.\mbox{\hyperlink{structendpoints__and__weights_a351e13ebfb998f06c4134c405cb5d0ec}{is\_constant\_weight\_error\_scale}};}
\DoxyCodeLine{00880\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\_error\_scale(ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}}[0]);}
\DoxyCodeLine{00881\ }
\DoxyCodeLine{00882\ \ \ \ \ \textcolor{comment}{//\ This\ overshoots\ -\/\ this\ is\ OK\ as\ we\ initialize\ the\ array\ tails\ in\ the}}
\DoxyCodeLine{00883\ \ \ \ \ \textcolor{comment}{//\ decimation\ table\ structures\ to\ safe\ values\ ...}}
\DoxyCodeLine{00884\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ weight\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00885\ \ \ \ \ \{}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ with\ a\ small\ value\ to\ avoid\ div-\/by-\/zero\ later}}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\_weight(1e-\/10f);}
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ initial\_weight\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat::zero}}();}
\DoxyCodeLine{00889\ }
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Accumulate\ error\ weighting\ of\ all\ the\ texels\ using\ this\ weight}}
\DoxyCodeLine{00891\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weight\_texel\_count(di.\mbox{\hyperlink{structdecimation__info_af8cbdbb54638ad694f845fb0bd96d007}{weight\_texel\_count}}\ +\ i);}
\DoxyCodeLine{00892\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ max\_texel\_count\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a516a2f0d872381b8c7c047845a90c9a3}{hmax}}(weight\_texel\_count).\mbox{\hyperlink{structvint8_a2e1f0c785f4899e1b7912f2580b9f77c}{lane}}<0>();}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(max\_texel\_count\ >\ 0);}
\DoxyCodeLine{00894\ }
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ max\_texel\_count;\ j++)}
\DoxyCodeLine{00896\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00897\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ texel(di.\mbox{\hyperlink{structdecimation__info_a312c1244893e84561d7d01bb43493d2e}{weight\_texels\_tr}}[j]\ +\ i);}
\DoxyCodeLine{00898\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(di.\mbox{\hyperlink{structdecimation__info_a8938034ba8a3eeb122662bf5d90df522}{weights\_texel\_contribs\_tr}}[j]\ +\ i);}
\DoxyCodeLine{00899\ }
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!constant\_wes)}
\DoxyCodeLine{00901\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ weight\_error\_scale\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}},\ texel);}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00904\ }
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ contrib\_weight\ =\ weight\ *\ weight\_error\_scale;}
\DoxyCodeLine{00906\ }
\DoxyCodeLine{00907\ \ \ \ \ \ \ \ \ \ \ \ \ weight\_weight\ +=\ contrib\_weight;}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ \ \ \ \ initial\_weight\ +=\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}},\ texel)\ *\ contrib\_weight;}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00910\ }
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(initial\_weight\ /\ weight\_weight,\ dec\_weight\_ideal\_value\ +\ i);}
\DoxyCodeLine{00912\ \ \ \ \ \}}
\DoxyCodeLine{00913\ }
\DoxyCodeLine{00914\ \ \ \ \ \textcolor{comment}{//\ Populate\ the\ interpolated\ weight\ grid\ based\ on\ the\ initial\ average}}
\DoxyCodeLine{00915\ \ \ \ \ \textcolor{comment}{//\ Process\ SIMD-\/width\ texel\ coordinates\ at\ at\ time\ while\ we\ can.\ Safe\ to}}
\DoxyCodeLine{00916\ \ \ \ \ \textcolor{comment}{//\ over-\/process\ full\ SIMD\ vectors\ -\/\ the\ tail\ is\ zeroed.}}
\DoxyCodeLine{00917\ \ \ \ \ \textcolor{keywordflow}{if}\ (di.\mbox{\hyperlink{structdecimation__info_a1419dcd0f618164042315f80527d3f4f}{max\_texel\_weight\_count}}\ <=\ 2)}
\DoxyCodeLine{00918\ \ \ \ \ \{}
\DoxyCodeLine{00919\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45}{bilinear\_infill\_vla\_2}}(di,\ dec\_weight\_ideal\_value,\ i);}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(weight,\ infilled\_weights\ +\ i);}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00924\ \ \ \ \ \}}
\DoxyCodeLine{00925\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00926\ \ \ \ \ \{}
\DoxyCodeLine{00927\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00928\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00929\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca}{bilinear\_infill\_vla}}(di,\ dec\_weight\_ideal\_value,\ i);}
\DoxyCodeLine{00930\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(weight,\ infilled\_weights\ +\ i);}
\DoxyCodeLine{00931\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00932\ \ \ \ \ \}}
\DoxyCodeLine{00933\ }
\DoxyCodeLine{00934\ \ \ \ \ \textcolor{comment}{//\ Perform\ a\ single\ iteration\ of\ refinement}}
\DoxyCodeLine{00935\ \ \ \ \ \textcolor{comment}{//\ Empirically\ determined\ step\ size;\ larger\ values\ don't\ help\ but\ smaller\ drops\ image\ quality}}
\DoxyCodeLine{00936\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{float}\ stepsize\ =\ 0.25f;}
\DoxyCodeLine{00937\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{float}\ chd\_scale\ =\ -\/\mbox{\hyperlink{astcenc__internal_8h_a00c99c52668709ec2e60ec1eb401e55a}{WEIGHTS\_TEXEL\_SUM}};}
\DoxyCodeLine{00938\ }
\DoxyCodeLine{00939\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ weight\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{00940\ \ \ \ \ \{}
\DoxyCodeLine{00941\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\_val\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(dec\_weight\_ideal\_value\ +\ i);}
\DoxyCodeLine{00942\ }
\DoxyCodeLine{00943\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Accumulate\ error\ weighting\ of\ all\ the\ texels\ using\ this\ weight}}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ with\ a\ small\ value\ to\ avoid\ div-\/by-\/zero\ later}}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error\_change0(1e-\/10f);}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ error\_change1(0.0f);}
\DoxyCodeLine{00947\ }
\DoxyCodeLine{00948\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Accumulate\ error\ weighting\ of\ all\ the\ texels\ using\ this\ weight}}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weight\_texel\_count(di.\mbox{\hyperlink{structdecimation__info_af8cbdbb54638ad694f845fb0bd96d007}{weight\_texel\_count}}\ +\ i);}
\DoxyCodeLine{00950\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ max\_texel\_count\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a516a2f0d872381b8c7c047845a90c9a3}{hmax}}(weight\_texel\_count).\mbox{\hyperlink{structvint8_a2e1f0c785f4899e1b7912f2580b9f77c}{lane}}<0>();}
\DoxyCodeLine{00951\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(max\_texel\_count\ >\ 0);}
\DoxyCodeLine{00952\ }
\DoxyCodeLine{00953\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ max\_texel\_count;\ j++)}
\DoxyCodeLine{00954\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ texel(di.\mbox{\hyperlink{structdecimation__info_a312c1244893e84561d7d01bb43493d2e}{weight\_texels\_tr}}[j]\ +\ i);}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ contrib\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(di.\mbox{\hyperlink{structdecimation__info_a8938034ba8a3eeb122662bf5d90df522}{weights\_texel\_contribs\_tr}}[j]\ +\ i);}
\DoxyCodeLine{00957\ }
\DoxyCodeLine{00958\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!constant\_wes)}
\DoxyCodeLine{00959\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00960\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ weight\_error\_scale\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(ei.\mbox{\hyperlink{structendpoints__and__weights_a7e487945a9fdc482afc3015b47bc9ee7}{weight\_error\_scale}},\ texel);}
\DoxyCodeLine{00961\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00962\ }
\DoxyCodeLine{00963\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ scale\ =\ weight\_error\_scale\ *\ contrib\_weight;}
\DoxyCodeLine{00964\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ old\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(infilled\_weights,\ texel);}
\DoxyCodeLine{00965\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ ideal\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aae2f99eb48f3cde0f4739b894e8ca29f}{gatherf}}(ei.\mbox{\hyperlink{structendpoints__and__weights_a2f7e43bbb9027b71c7b240be53251217}{weights}},\ texel);}
\DoxyCodeLine{00966\ }
\DoxyCodeLine{00967\ \ \ \ \ \ \ \ \ \ \ \ \ error\_change0\ +=\ contrib\_weight\ *\ scale;}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \ \ \ \ error\_change1\ +=\ (old\_weight\ -\/\ ideal\_weight)\ *\ scale;}
\DoxyCodeLine{00969\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00970\ }
\DoxyCodeLine{00971\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ step\ =\ (error\_change1\ *\ chd\_scale)\ /\ error\_change0;}
\DoxyCodeLine{00972\ \ \ \ \ \ \ \ \ step\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ae91c0bb0ebd82ed2a7fa7aa915f6e76e}{clamp}}(-\/stepsize,\ stepsize,\ step);}
\DoxyCodeLine{00973\ }
\DoxyCodeLine{00974\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ the\ weight;\ note\ this\ can\ store\ negative\ values}}
\DoxyCodeLine{00975\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(weight\_val\ +\ step,\ dec\_weight\_ideal\_value\ +\ i);}
\DoxyCodeLine{00976\ \ \ \ \ \}}
\DoxyCodeLine{00977\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_ae1b4e922c67d5349fc849709ca08178f_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_ae1b4e922c67d5349fc849709ca08178f_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_af42cf444db5f16e2ed4fb642acf81f4a}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_quantized\_weights\_for\_decimation@{compute\_quantized\_weights\_for\_decimation}}
\index{compute\_quantized\_weights\_for\_decimation@{compute\_quantized\_weights\_for\_decimation}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_quantized\_weights\_for\_decimation()}{compute\_quantized\_weights\_for\_decimation()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_af42cf444db5f16e2ed4fb642acf81f4a} 
void compute\+\_\+quantized\+\_\+weights\+\_\+for\+\_\+decimation (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&}]{di}{, }\item[{float}]{low\+\_\+bound}{, }\item[{float}]{high\+\_\+bound}{, }\item[{const float \texorpdfstring{$\ast$}{*}}]{dec\+\_\+weight\+\_\+ideal\+\_\+value}{, }\item[{float \texorpdfstring{$\ast$}{*}}]{dec\+\_\+weight\+\_\+quant\+\_\+uvalue}{, }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{dec\+\_\+weight\+\_\+uquant}{, }\item[{\mbox{\hyperlink{astcenc__internal_8h_a806a5b8001942a6fa06d788ffec45a75}{quant\+\_\+method}}}]{quant\+\_\+level}{}\end{DoxyParamCaption})}



Compute the optimal quantized weights for a decimation table. 

We test the two closest weight indices in the allowed quantization range and keep the weight that is the closest match.


\begin{DoxyParams}[1]{매개변수}
 & {\em di} & The selected weight decimation. \\
\hline
 & {\em low\+\_\+bound} & The lowest weight allowed. \\
\hline
 & {\em high\+\_\+bound} & The highest weight allowed. \\
\hline
 & {\em dec\+\_\+weight\+\_\+ideal\+\_\+value} & The ideal weight set. \\
\hline
\mbox{\texttt{ out}}  & {\em dec\+\_\+weight\+\_\+quant\+\_\+uvalue} & The output quantized weight as a float. \\
\hline
\mbox{\texttt{ out}}  & {\em dec\+\_\+weight\+\_\+uquant} & The output quantized weight as encoded int. \\
\hline
 & {\em quant\+\_\+level} & The desired weight quant level. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l00980}{980}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00988\ \ \ \{}
\DoxyCodeLine{00989\ \ \ \ \ \textcolor{keywordtype}{int}\ weight\_count\ =\ di.\mbox{\hyperlink{structdecimation__info_af7d0c86be805995a20a6c09f6c3ab8ca}{weight\_count}};}
\DoxyCodeLine{00990\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(weight\_count\ >\ 0);}
\DoxyCodeLine{00991\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structquant__and__transfer__table}{quant\_and\_transfer\_table}}\&\ qat\ =\ \mbox{\hyperlink{astcenc__internal_8h_a9d58fe49f85551cd8c9ccadb5aece318}{quant\_and\_xfer\_tables}}[quant\_level];}
\DoxyCodeLine{00992\ }
\DoxyCodeLine{00993\ \ \ \ \ \textcolor{comment}{//\ The\ available\ quant\ levels,\ stored\ with\ a\ minus\ 1\ bias}}
\DoxyCodeLine{00994\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ quant\_levels\_m1[12]\ \{}
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ 1.0f,\ 2.0f,\ 3.0f,\ 4.0f,\ 5.0f,\ 7.0f,\ 9.0f,\ 11.0f,\ 15.0f,\ 19.0f,\ 23.0f,\ 31.0f}
\DoxyCodeLine{00996\ \ \ \ \ \};}
\DoxyCodeLine{00997\ }
\DoxyCodeLine{00998\ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ steps\_m1(\mbox{\hyperlink{astcenc__internal_8h_aec456deb917676d5506d91947c6d5726}{get\_quant\_level}}(quant\_level)\ -\/\ 1);}
\DoxyCodeLine{00999\ \ \ \ \ \textcolor{keywordtype}{float}\ quant\_level\_m1\ =\ quant\_levels\_m1[quant\_level];}
\DoxyCodeLine{01000\ }
\DoxyCodeLine{01001\ \ \ \ \ \textcolor{comment}{//\ Quantize\ the\ weight\ set\ using\ both\ the\ specified\ low/high\ bounds\ and\ standard\ 0..1\ bounds}}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01003\ \ \ \ \ \textcolor{comment}{//\ TODO:\ Oddity\ to\ investigate;\ triggered\ by\ test\ in\ issue\ \#265.}}
\DoxyCodeLine{01004\ \ \ \ \ \textcolor{keywordflow}{if}\ (high\_bound\ <=\ low\_bound)}
\DoxyCodeLine{01005\ \ \ \ \ \{}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ low\_bound\ =\ 0.0f;}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ high\_bound\ =\ 1.0f;}
\DoxyCodeLine{01008\ \ \ \ \ \}}
\DoxyCodeLine{01009\ }
\DoxyCodeLine{01010\ \ \ \ \ \textcolor{keywordtype}{float}\ rscale\ =\ high\_bound\ -\/\ low\_bound;}
\DoxyCodeLine{01011\ \ \ \ \ \textcolor{keywordtype}{float}\ scale\ =\ 1.0f\ /\ rscale;}
\DoxyCodeLine{01012\ }
\DoxyCodeLine{01013\ \ \ \ \ \textcolor{keywordtype}{float}\ scaled\_low\_bound\ =\ low\_bound\ *\ scale;}
\DoxyCodeLine{01014\ \ \ \ \ rscale\ *=\ 1.0f\ /\ 64.0f;}
\DoxyCodeLine{01015\ }
\DoxyCodeLine{01016\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ scalev(scale);}
\DoxyCodeLine{01017\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ scaled\_low\_boundv(scaled\_low\_bound);}
\DoxyCodeLine{01018\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ quant\_level\_m1v(quant\_level\_m1);}
\DoxyCodeLine{01019\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ rscalev(rscale);}
\DoxyCodeLine{01020\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ low\_boundv(low\_bound);}
\DoxyCodeLine{01021\ }
\DoxyCodeLine{01022\ \ \ \ \ \textcolor{comment}{//\ This\ runs\ to\ the\ rounded-\/up\ SIMD\ size,\ which\ is\ safe\ as\ the\ loop\ tail\ is\ filled\ with\ known}}
\DoxyCodeLine{01023\ \ \ \ \ \textcolor{comment}{//\ safe\ data\ in\ compute\_ideal\_weights\_for\_decimation\ and\ arrays\ are\ always\ 64\ elements}}
\DoxyCodeLine{01024\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{astcenc__internal_8h_aec456deb917676d5506d91947c6d5726}{get\_quant\_level}}(quant\_level)\ <=\ 16)}
\DoxyCodeLine{01025\ \ \ \ \ \{}
\DoxyCodeLine{01026\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint4}}\ tab0\ =\ \mbox{\hyperlink{structvint4_ab899bfb3323ffa799403172941113a7e}{vint4::load}}(qat.\mbox{\hyperlink{structquant__and__transfer__table_ab19e214b6fa5cc1b432419d34133fbc9}{quant\_to\_unquant}});}
\DoxyCodeLine{01027\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ tab0p;}
\DoxyCodeLine{01028\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a38035a0e5616592fa235308dc60c476f}{vtable\_prepare}}(tab0,\ tab0p);}
\DoxyCodeLine{01029\ }
\DoxyCodeLine{01030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ weight\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{01031\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ ix\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(dec\_weight\_ideal\_value\ +\ i)\ *\ scalev\ -\/\ scaled\_low\_boundv;}
\DoxyCodeLine{01033\ \ \ \ \ \ \ \ \ \ \ \ \ ix\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a154fea8d8c99676fb5550ff40eed3d75}{clampzo}}(ix);}
\DoxyCodeLine{01034\ }
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ up\ the\ two\ closest\ indexes\ and\ return\ the\ one\ that\ was\ closest}}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ ix1\ =\ ix\ *\ quant\_level\_m1v;}
\DoxyCodeLine{01037\ }
\DoxyCodeLine{01038\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weightl\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_afdaab5e0b4a39a5dd28fb5b40642e57d}{float\_to\_int}}(ix1);}
\DoxyCodeLine{01039\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weighth\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a165b3db4e7ced1551e1880a01a01150b}{min}}(weightl\ +\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1d994704cca1a088c460bd5a3058e3bc}{vint}}(1),\ steps\_m1);}
\DoxyCodeLine{01040\ }
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ ixli\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a2778951898aea88de4dd7881e7cd817b}{vtable\_8bt\_32bi}}(tab0p,\ weightl);}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ ixhi\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a2778951898aea88de4dd7881e7cd817b}{vtable\_8bt\_32bi}}(tab0p,\ weighth);}
\DoxyCodeLine{01043\ }
\DoxyCodeLine{01044\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ ixl\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a3a2ce0fb403294db7fe126a6b3e87ab7}{int\_to\_float}}(ixli);}
\DoxyCodeLine{01045\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ ixh\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a3a2ce0fb403294db7fe126a6b3e87ab7}{int\_to\_float}}(ixhi);}
\DoxyCodeLine{01046\ }
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask}}\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad922a3ed6098767968916265154b6f82}{mask}}\ =\ (ixl\ +\ ixh)\ <\ (\mbox{\hyperlink{astcenc__vecmathlib_8h_a3a29c3b15144cf0836ca0f4740b73d00}{vfloat}}(128.0f)\ *\ ix);}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ixli,\ ixhi,\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad922a3ed6098767968916265154b6f82}{mask}});}
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ \ \ \ \ ixl\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ixl,\ ixh,\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad922a3ed6098767968916265154b6f82}{mask}});}
\DoxyCodeLine{01050\ }
\DoxyCodeLine{01051\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Invert\ the\ weight-\/scaling\ that\ was\ done\ initially}}
\DoxyCodeLine{01052\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(ixl\ *\ rscalev\ +\ low\_boundv,\ weight\_set\_out\ +\ i);}
\DoxyCodeLine{01053\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ scn\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a98f7a50685f56b5c84d1c760fa037d6d}{pack\_low\_bytes}}(weight);}
\DoxyCodeLine{01054\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ac55f9ffdc41bee5d274cb6433809fefc}{store\_nbytes}}(scn,\ quantized\_weight\_set\ +\ i);}
\DoxyCodeLine{01055\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01056\ \ \ \ \ \}}
\DoxyCodeLine{01057\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01058\ \ \ \ \ \{}
\DoxyCodeLine{01059\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint4}}\ tab0\ =\ \mbox{\hyperlink{structvint4_ab899bfb3323ffa799403172941113a7e}{vint4::load}}(qat.\mbox{\hyperlink{structquant__and__transfer__table_ab19e214b6fa5cc1b432419d34133fbc9}{quant\_to\_unquant}}\ +\ \ 0);}
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint4}}\ tab1\ =\ \mbox{\hyperlink{structvint4_ab899bfb3323ffa799403172941113a7e}{vint4::load}}(qat.\mbox{\hyperlink{structquant__and__transfer__table_ab19e214b6fa5cc1b432419d34133fbc9}{quant\_to\_unquant}}\ +\ 16);}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ tab0p,\ tab1p;}
\DoxyCodeLine{01062\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a38035a0e5616592fa235308dc60c476f}{vtable\_prepare}}(tab0,\ tab1,\ tab0p,\ tab1p);}
\DoxyCodeLine{01063\ }
\DoxyCodeLine{01064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ weight\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{01065\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01066\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ ix\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a535908f39a759651e1adb70d750a96f7}{loada}}(dec\_weight\_ideal\_value\ +\ i)\ *\ scalev\ -\/\ scaled\_low\_boundv;}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \ \ \ \ \ \ ix\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a154fea8d8c99676fb5550ff40eed3d75}{clampzo}}(ix);}
\DoxyCodeLine{01068\ }
\DoxyCodeLine{01069\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ up\ the\ two\ closest\ indexes\ and\ return\ the\ one\ that\ was\ closest}}
\DoxyCodeLine{01070\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ ix1\ =\ ix\ *\ quant\_level\_m1v;}
\DoxyCodeLine{01071\ }
\DoxyCodeLine{01072\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weightl\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_afdaab5e0b4a39a5dd28fb5b40642e57d}{float\_to\_int}}(ix1);}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weighth\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a165b3db4e7ced1551e1880a01a01150b}{min}}(weightl\ +\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1d994704cca1a088c460bd5a3058e3bc}{vint}}(1),\ steps\_m1);}
\DoxyCodeLine{01074\ }
\DoxyCodeLine{01075\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ ixli\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a2778951898aea88de4dd7881e7cd817b}{vtable\_8bt\_32bi}}(tab0p,\ tab1p,\ weightl);}
\DoxyCodeLine{01076\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ ixhi\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a2778951898aea88de4dd7881e7cd817b}{vtable\_8bt\_32bi}}(tab0p,\ tab1p,\ weighth);}
\DoxyCodeLine{01077\ }
\DoxyCodeLine{01078\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ ixl\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a3a2ce0fb403294db7fe126a6b3e87ab7}{int\_to\_float}}(ixli);}
\DoxyCodeLine{01079\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ ixh\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a3a2ce0fb403294db7fe126a6b3e87ab7}{int\_to\_float}}(ixhi);}
\DoxyCodeLine{01080\ }
\DoxyCodeLine{01081\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask}}\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad922a3ed6098767968916265154b6f82}{mask}}\ =\ (ixl\ +\ ixh)\ <\ (\mbox{\hyperlink{astcenc__vecmathlib_8h_a3a29c3b15144cf0836ca0f4740b73d00}{vfloat}}(128.0f)\ *\ ix);}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ixli,\ ixhi,\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad922a3ed6098767968916265154b6f82}{mask}});}
\DoxyCodeLine{01083\ \ \ \ \ \ \ \ \ \ \ \ \ ixl\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ixl,\ ixh,\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad922a3ed6098767968916265154b6f82}{mask}});}
\DoxyCodeLine{01084\ }
\DoxyCodeLine{01085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Invert\ the\ weight-\/scaling\ that\ was\ done\ initially}}
\DoxyCodeLine{01086\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(ixl\ *\ rscalev\ +\ low\_boundv,\ weight\_set\_out\ +\ i);}
\DoxyCodeLine{01087\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ scn\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a98f7a50685f56b5c84d1c760fa037d6d}{pack\_low\_bytes}}(weight);}
\DoxyCodeLine{01088\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ac55f9ffdc41bee5d274cb6433809fefc}{store\_nbytes}}(scn,\ quantized\_weight\_set\ +\ i);}
\DoxyCodeLine{01089\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01090\ \ \ \ \ \}}
\DoxyCodeLine{01091\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=342pt]{astcenc__ideal__endpoints__and__weights_8cpp_af42cf444db5f16e2ed4fb642acf81f4a_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_af42cf444db5f16e2ed4fb642acf81f4a_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_a55d08b4feda289df7cbcfa6e1ed0b80c}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!compute\_rgbo\_vector@{compute\_rgbo\_vector}}
\index{compute\_rgbo\_vector@{compute\_rgbo\_vector}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{compute\_rgbo\_vector()}{compute\_rgbo\_vector()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_a55d08b4feda289df7cbcfa6e1ed0b80c} 
static \mbox{\hyperlink{structvfloat4}{vfloat4}} compute\+\_\+rgbo\+\_\+vector (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structvfloat4}{vfloat4}}}]{rgba\+\_\+weight\+\_\+sum}{, }\item[{\mbox{\hyperlink{structvfloat4}{vfloat4}}}]{weight\+\_\+weight\+\_\+sum}{, }\item[{\mbox{\hyperlink{structvfloat4}{vfloat4}}}]{rgbq\+\_\+sum}{, }\item[{float}]{psum}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Compute the RGB + offset for a HDR endpoint mode \#7. 

Since the matrix needed has a regular structure we can simplify the inverse calculation. This gives us \texorpdfstring{$\sim$}{\string~}24 multiplications vs. 96 for a generic inverse.

mat\mbox{[}0\mbox{]} = \doxylink{structvfloat4}{vfloat4}(rgba\+\_\+ws.\+x, 0.\+0f, 0.\+0f, wght\+\_\+ws.\+x); mat\mbox{[}1\mbox{]} = \doxylink{structvfloat4}{vfloat4}( 0.\+0f, rgba\+\_\+ws.\+y, 0.\+0f, wght\+\_\+ws.\+y); mat\mbox{[}2\mbox{]} = \doxylink{structvfloat4}{vfloat4}( 0.\+0f, 0.\+0f, rgba\+\_\+ws.\+z, wght\+\_\+ws.\+z); mat\mbox{[}3\mbox{]} = \doxylink{structvfloat4}{vfloat4}(wght\+\_\+ws.\+x, wght\+\_\+ws.\+y, wght\+\_\+ws.\+z, psum); mat = invert(mat);


\begin{DoxyParams}{매개변수}
{\em rgba\+\_\+weight\+\_\+sum} & Sum of partition component error weights. \\
\hline
{\em weight\+\_\+weight\+\_\+sum} & Sum of partition component error weights \texorpdfstring{$\ast$}{*} texel weight. \\
\hline
{\em rgbq\+\_\+sum} & Sum of partition component error weights \texorpdfstring{$\ast$}{*} texel weight \texorpdfstring{$\ast$}{*} color data. \\
\hline
{\em psum} & Sum of RGB color weights \texorpdfstring{$\ast$}{*} texel weight\texorpdfstring{$^\wedge$}{\string^}2. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l01110}{1110}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{01115\ \ \ \{}
\DoxyCodeLine{01116\ \ \ \ \ \textcolor{keywordtype}{float}\ X\ =\ rgba\_weight\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>();}
\DoxyCodeLine{01117\ \ \ \ \ \textcolor{keywordtype}{float}\ Y\ =\ rgba\_weight\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>();}
\DoxyCodeLine{01118\ \ \ \ \ \textcolor{keywordtype}{float}\ Z\ =\ rgba\_weight\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>();}
\DoxyCodeLine{01119\ \ \ \ \ \textcolor{keywordtype}{float}\ P\ =\ weight\_weight\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>();}
\DoxyCodeLine{01120\ \ \ \ \ \textcolor{keywordtype}{float}\ Q\ =\ weight\_weight\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>();}
\DoxyCodeLine{01121\ \ \ \ \ \textcolor{keywordtype}{float}\ R\ =\ weight\_weight\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>();}
\DoxyCodeLine{01122\ \ \ \ \ \textcolor{keywordtype}{float}\ S\ =\ psum;}
\DoxyCodeLine{01123\ }
\DoxyCodeLine{01124\ \ \ \ \ \textcolor{keywordtype}{float}\ PP\ =\ P\ *\ P;}
\DoxyCodeLine{01125\ \ \ \ \ \textcolor{keywordtype}{float}\ QQ\ =\ Q\ *\ Q;}
\DoxyCodeLine{01126\ \ \ \ \ \textcolor{keywordtype}{float}\ RR\ =\ R\ *\ R;}
\DoxyCodeLine{01127\ }
\DoxyCodeLine{01128\ \ \ \ \ \textcolor{keywordtype}{float}\ SZmRR\ =\ S\ *\ Z\ -\/\ RR;}
\DoxyCodeLine{01129\ \ \ \ \ \textcolor{keywordtype}{float}\ DT\ =\ SZmRR\ *\ Y\ -\/\ Z\ *\ QQ;}
\DoxyCodeLine{01130\ \ \ \ \ \textcolor{keywordtype}{float}\ YP\ =\ Y\ *\ P;}
\DoxyCodeLine{01131\ \ \ \ \ \textcolor{keywordtype}{float}\ QX\ =\ Q\ *\ X;}
\DoxyCodeLine{01132\ \ \ \ \ \textcolor{keywordtype}{float}\ YX\ =\ Y\ *\ X;}
\DoxyCodeLine{01133\ \ \ \ \ \textcolor{keywordtype}{float}\ mZYP\ =\ -\/Z\ *\ YP;}
\DoxyCodeLine{01134\ \ \ \ \ \textcolor{keywordtype}{float}\ mZQX\ =\ -\/Z\ *\ QX;}
\DoxyCodeLine{01135\ \ \ \ \ \textcolor{keywordtype}{float}\ mRYX\ =\ -\/R\ *\ YX;}
\DoxyCodeLine{01136\ \ \ \ \ \textcolor{keywordtype}{float}\ ZQP\ =\ Z\ *\ Q\ *\ P;}
\DoxyCodeLine{01137\ \ \ \ \ \textcolor{keywordtype}{float}\ RYP\ =\ R\ *\ YP;}
\DoxyCodeLine{01138\ \ \ \ \ \textcolor{keywordtype}{float}\ RQX\ =\ R\ *\ QX;}
\DoxyCodeLine{01139\ }
\DoxyCodeLine{01140\ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ reciprocal\ of\ matrix\ determinant}}
\DoxyCodeLine{01141\ \ \ \ \ \textcolor{keywordtype}{float}\ rdet\ =\ 1.0f\ /\ (DT\ *\ X\ +\ mZYP\ *\ P);}
\DoxyCodeLine{01142\ }
\DoxyCodeLine{01143\ \ \ \ \ \textcolor{comment}{//\ Actually\ compute\ the\ adjugate,\ and\ then\ apply\ 1/det\ separately}}
\DoxyCodeLine{01144\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ mat0(DT,\ ZQP,\ RYP,\ mZYP);}
\DoxyCodeLine{01145\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ mat1(ZQP,\ SZmRR\ *\ X\ -\/\ Z\ *\ PP,\ RQX,\ mZQX);}
\DoxyCodeLine{01146\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ mat2(RYP,\ RQX,\ (S\ *\ Y\ -\/\ QQ)\ *\ X\ -\/\ Y\ *\ PP,\ mRYX);}
\DoxyCodeLine{01147\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ mat3(mZYP,\ mZQX,\ mRYX,\ Z\ *\ YX);}
\DoxyCodeLine{01148\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ vect\ =\ rgbq\_sum\ *\ rdet;}
\DoxyCodeLine{01149\ }
\DoxyCodeLine{01150\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(\mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a53a7d8285fd42b50cf3600a004db34ac}{dot\_s}}(mat0,\ vect),}
\DoxyCodeLine{01151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a53a7d8285fd42b50cf3600a004db34ac}{dot\_s}}(mat1,\ vect),}
\DoxyCodeLine{01152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a53a7d8285fd42b50cf3600a004db34ac}{dot\_s}}(mat2,\ vect),}
\DoxyCodeLine{01153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a53a7d8285fd42b50cf3600a004db34ac}{dot\_s}}(mat3,\ vect));}
\DoxyCodeLine{01154\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a55d08b4feda289df7cbcfa6e1ed0b80c_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a55d08b4feda289df7cbcfa6e1ed0b80c_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_a02bcad94240678ee727ccf2f0fbfb5d3}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!recompute\_ideal\_colors\_1plane@{recompute\_ideal\_colors\_1plane}}
\index{recompute\_ideal\_colors\_1plane@{recompute\_ideal\_colors\_1plane}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{recompute\_ideal\_colors\_1plane()}{recompute\_ideal\_colors\_1plane()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_a02bcad94240678ee727ccf2f0fbfb5d3} 
void recompute\+\_\+ideal\+\_\+colors\+\_\+1plane (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&}]{blk}{, }\item[{const \mbox{\hyperlink{structpartition__info}{partition\+\_\+info}} \&}]{pi}{, }\item[{const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&}]{di}{, }\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{dec\+\_\+weights\+\_\+uquant}{, }\item[{\mbox{\hyperlink{structendpoints}{endpoints}} \&}]{ep}{, }\item[{\mbox{\hyperlink{structvfloat4}{vfloat4}}}]{rgbs\+\_\+vectors}{\mbox{[}\+BLOCK\+\_\+\+MAX\+\_\+\+PARTITIONS\mbox{]}, }\item[{\mbox{\hyperlink{structvfloat4}{vfloat4}}}]{rgbo\+\_\+vectors}{\mbox{[}\+BLOCK\+\_\+\+MAX\+\_\+\+PARTITIONS\mbox{]}}\end{DoxyParamCaption})}



For a given 1 plane weight set recompute the endpoint colors. 

As we quantize and decimate weights the optimal endpoint colors may change slightly, so we must recompute the ideal colors for a specific weight set.


\begin{DoxyParams}[1]{매개변수}
 & {\em blk} & The image block color data to compress. \\
\hline
 & {\em pi} & The partition info for the current trial. \\
\hline
 & {\em di} & The weight grid decimation table. \\
\hline
 & {\em dec\+\_\+weights\+\_\+uquant} & The quantized weight set. \\
\hline
\mbox{\texttt{ in,out}}  & {\em ep} & The color endpoints (modifed in place). \\
\hline
\mbox{\texttt{ out}}  & {\em rgbs\+\_\+vectors} & The RGB+scale vectors for LDR blocks. \\
\hline
\mbox{\texttt{ out}}  & {\em rgbo\+\_\+vectors} & The RGB+offset vectors for HDR blocks. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l01157}{1157}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{01165\ \ \ \{}
\DoxyCodeLine{01166\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ weight\_count\ =\ di.\mbox{\hyperlink{structdecimation__info_af7d0c86be805995a20a6c09f6c3ab8ca}{weight\_count}};}
\DoxyCodeLine{01167\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ total\_texel\_count\ =\ blk.\mbox{\hyperlink{structimage__block_a05174b1db0b9131ad61fc49f3aa74676}{texel\_count}};}
\DoxyCodeLine{01168\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partition\_count\ =\ pi.\mbox{\hyperlink{structpartition__info_a1ffb0fdd4d560f536d6118f032fba4f3}{partition\_count}};}
\DoxyCodeLine{01169\ }
\DoxyCodeLine{01170\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(weight\_count\ >\ 0);}
\DoxyCodeLine{01171\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(total\_texel\_count\ >\ 0);}
\DoxyCodeLine{01172\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(partition\_count\ >\ 0);}
\DoxyCodeLine{01173\ }
\DoxyCodeLine{01174\ \ \ \ \ \mbox{\hyperlink{astcenc__mathlib_8h_adf60643d2894fb1d3cd00d4f907186e8}{ASTCENC\_ALIGNAS}}\ \textcolor{keywordtype}{float}\ dec\_weight[\mbox{\hyperlink{astcenc__internal_8h_aa069d5d400baafe528bce4778aba6c45}{BLOCK\_MAX\_WEIGHTS}}];}
\DoxyCodeLine{01175\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ weight\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{01176\ \ \ \ \ \{}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ unquant\_value(dec\_weights\_uquant\ +\ i);}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ unquant\_valuef\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a3a2ce0fb403294db7fe126a6b3e87ab7}{int\_to\_float}}(unquant\_value)\ *\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a3a29c3b15144cf0836ca0f4740b73d00}{vfloat}}(1.0f\ /\ 64.0f);}
\DoxyCodeLine{01179\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(unquant\_valuef,\ dec\_weight\ +\ i);}
\DoxyCodeLine{01180\ \ \ \ \ \}}
\DoxyCodeLine{01181\ }
\DoxyCodeLine{01182\ \ \ \ \ \mbox{\hyperlink{astcenc__mathlib_8h_adf60643d2894fb1d3cd00d4f907186e8}{ASTCENC\_ALIGNAS}}\ \textcolor{keywordtype}{float}\ undec\_weight[\mbox{\hyperlink{astcenc__internal_8h_ad694a8ff82a68a50b11bac439531241e}{BLOCK\_MAX\_TEXELS}}];}
\DoxyCodeLine{01183\ \ \ \ \ \textcolor{keywordtype}{float}*\ undec\_weight\_ref;}
\DoxyCodeLine{01184\ \ \ \ \ \textcolor{keywordflow}{if}\ (di.\mbox{\hyperlink{structdecimation__info_a1419dcd0f618164042315f80527d3f4f}{max\_texel\_weight\_count}}\ ==\ 1)}
\DoxyCodeLine{01185\ \ \ \ \ \{}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \ \ undec\_weight\_ref\ =\ dec\_weight;}
\DoxyCodeLine{01187\ \ \ \ \ \}}
\DoxyCodeLine{01188\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (di.\mbox{\hyperlink{structdecimation__info_a1419dcd0f618164042315f80527d3f4f}{max\_texel\_weight\_count}}\ <=\ 2)}
\DoxyCodeLine{01189\ \ \ \ \ \{}
\DoxyCodeLine{01190\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ total\_texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{01191\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01192\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45}{bilinear\_infill\_vla\_2}}(di,\ dec\_weight,\ i);}
\DoxyCodeLine{01193\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(weight,\ undec\_weight\ +\ i);}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01195\ }
\DoxyCodeLine{01196\ \ \ \ \ \ \ \ \ undec\_weight\_ref\ =\ undec\_weight;}
\DoxyCodeLine{01197\ \ \ \ \ \}}
\DoxyCodeLine{01198\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01199\ \ \ \ \ \{}
\DoxyCodeLine{01200\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ total\_texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01202\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca}{bilinear\_infill\_vla}}(di,\ dec\_weight,\ i);}
\DoxyCodeLine{01203\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(weight,\ undec\_weight\ +\ i);}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01205\ }
\DoxyCodeLine{01206\ \ \ \ \ \ \ \ \ undec\_weight\_ref\ =\ undec\_weight;}
\DoxyCodeLine{01207\ \ \ \ \ \}}
\DoxyCodeLine{01208\ }
\DoxyCodeLine{01209\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ rgba\_sum(blk.\mbox{\hyperlink{structimage__block_ac6bd4890338be887b61f857e37d23459}{data\_mean}}\ *\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(blk.\mbox{\hyperlink{structimage__block_a05174b1db0b9131ad61fc49f3aa74676}{texel\_count}}));}
\DoxyCodeLine{01210\ }
\DoxyCodeLine{01211\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ partition\_count;\ i++)}
\DoxyCodeLine{01212\ \ \ \ \ \{}
\DoxyCodeLine{01213\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\ =\ pi.\mbox{\hyperlink{structpartition__info_a92b324c921407ee30e6052426e00e0f6}{partition\_texel\_count}}[i];}
\DoxyCodeLine{01214\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t\ *texel\_indexes\ =\ pi.\mbox{\hyperlink{structpartition__info_af0987713fff05a82c3230d9400c6e1e7}{texels\_of\_partition}}[i];}
\DoxyCodeLine{01215\ }
\DoxyCodeLine{01216\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ compute\ a\ partition\ mean\ if\ more\ than\ one\ partition}}
\DoxyCodeLine{01217\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (partition\_count\ >\ 1)}
\DoxyCodeLine{01218\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01219\ \ \ \ \ \ \ \ \ \ \ \ \ rgba\_sum\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat4::zero}}();}
\DoxyCodeLine{01220\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(texel\_count\ >\ 0);}
\DoxyCodeLine{01221\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ texel\_count;\ j++)}
\DoxyCodeLine{01222\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tix\ =\ texel\_indexes[j];}
\DoxyCodeLine{01224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rgba\_sum\ +=\ blk.\mbox{\hyperlink{structimage__block_af99de7d75e1e380b31d70d131509caa9}{texel}}(tix);}
\DoxyCodeLine{01225\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01226\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01227\ }
\DoxyCodeLine{01228\ \ \ \ \ \ \ \ \ rgba\_sum\ =\ rgba\_sum\ *\ blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}};}
\DoxyCodeLine{01229\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ rgba\_weight\_sum\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aa162915c044e97cc1f6d630338761fd3}{max}}(blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}\ *\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(texel\_count),\ 1e-\/17f);}
\DoxyCodeLine{01230\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ scale\_dir\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a48bcfcd0946caec9323acbf4bf1126ce}{normalize}}((rgba\_sum\ /\ rgba\_weight\_sum).swz<0,\ 1,\ 2>());}
\DoxyCodeLine{01231\ }
\DoxyCodeLine{01232\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\_max\ =\ 0.0f;}
\DoxyCodeLine{01233\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\_min\ =\ 1e10f;}
\DoxyCodeLine{01234\ }
\DoxyCodeLine{01235\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ wmin1\ =\ 1.0f;}
\DoxyCodeLine{01236\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ wmax1\ =\ 0.0f;}
\DoxyCodeLine{01237\ }
\DoxyCodeLine{01238\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ left\_sum\_s\ =\ 0.0f;}
\DoxyCodeLine{01239\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ middle\_sum\_s\ =\ 0.0f;}
\DoxyCodeLine{01240\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ right\_sum\_s\ =\ 0.0f;}
\DoxyCodeLine{01241\ }
\DoxyCodeLine{01242\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_vec\_x\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat4::zero}}();}
\DoxyCodeLine{01243\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_vec\_y\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat4::zero}}();}
\DoxyCodeLine{01244\ }
\DoxyCodeLine{01245\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ scale\_vec\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat4::zero}}();}
\DoxyCodeLine{01246\ }
\DoxyCodeLine{01247\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ weight\_weight\_sum\_s\ =\ 1e-\/17f;}
\DoxyCodeLine{01248\ }
\DoxyCodeLine{01249\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_weight\ =\ blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}};}
\DoxyCodeLine{01250\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ ls\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a48e833d0cfdf950b6bc3431fce00507e}{hadd\_rgb\_s}}(color\_weight);}
\DoxyCodeLine{01251\ }
\DoxyCodeLine{01252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ texel\_count;\ j++)}
\DoxyCodeLine{01253\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ tix\ =\ texel\_indexes[j];}
\DoxyCodeLine{01255\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ rgba\ =\ blk.\mbox{\hyperlink{structimage__block_af99de7d75e1e380b31d70d131509caa9}{texel}}(tix);}
\DoxyCodeLine{01256\ }
\DoxyCodeLine{01257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ idx0\ =\ undec\_weight\_ref[tix];}
\DoxyCodeLine{01258\ }
\DoxyCodeLine{01259\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ om\_idx0\ =\ 1.0f\ -\/\ idx0;}
\DoxyCodeLine{01260\ \ \ \ \ \ \ \ \ \ \ \ \ wmin1\ =\ \mbox{\hyperlink{namespaceastc_af78c0d31374aa9923633a3a2abf8d738}{astc::min}}(idx0,\ wmin1);}
\DoxyCodeLine{01261\ \ \ \ \ \ \ \ \ \ \ \ \ wmax1\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(idx0,\ wmax1);}
\DoxyCodeLine{01262\ }
\DoxyCodeLine{01263\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\ =\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a377cafdb98d3ee38a2999ed00504f477}{dot3\_s}}(scale\_dir,\ rgba);}
\DoxyCodeLine{01264\ \ \ \ \ \ \ \ \ \ \ \ \ scale\_min\ =\ \mbox{\hyperlink{namespaceastc_af78c0d31374aa9923633a3a2abf8d738}{astc::min}}(scale,\ scale\_min);}
\DoxyCodeLine{01265\ \ \ \ \ \ \ \ \ \ \ \ \ scale\_max\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(scale,\ scale\_max);}
\DoxyCodeLine{01266\ }
\DoxyCodeLine{01267\ \ \ \ \ \ \ \ \ \ \ \ \ left\_sum\_s\ \ \ +=\ om\_idx0\ *\ om\_idx0;}
\DoxyCodeLine{01268\ \ \ \ \ \ \ \ \ \ \ \ \ middle\_sum\_s\ +=\ om\_idx0\ *\ idx0;}
\DoxyCodeLine{01269\ \ \ \ \ \ \ \ \ \ \ \ \ right\_sum\_s\ \ +=\ idx0\ *\ idx0;}
\DoxyCodeLine{01270\ \ \ \ \ \ \ \ \ \ \ \ \ weight\_weight\_sum\_s\ +=\ idx0;}
\DoxyCodeLine{01271\ }
\DoxyCodeLine{01272\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_idx(idx0);}
\DoxyCodeLine{01273\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ cwprod\ =\ rgba;}
\DoxyCodeLine{01274\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ cwiprod\ =\ cwprod\ *\ color\_idx;}
\DoxyCodeLine{01275\ }
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \ \ \ \ color\_vec\_y\ +=\ cwiprod;}
\DoxyCodeLine{01277\ \ \ \ \ \ \ \ \ \ \ \ \ color\_vec\_x\ +=\ cwprod\ -\/\ cwiprod;}
\DoxyCodeLine{01278\ }
\DoxyCodeLine{01279\ \ \ \ \ \ \ \ \ \ \ \ \ scale\_vec\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a4750532a1dbacf2063927a027725afde}{vfloat2}}(om\_idx0,\ idx0)\ *\ (scale\ *\ ls\_weight);}
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01281\ }
\DoxyCodeLine{01282\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ left\_sum\ \ \ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(left\_sum\_s)\ *\ color\_weight;}
\DoxyCodeLine{01283\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ middle\_sum\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(middle\_sum\_s)\ *\ color\_weight;}
\DoxyCodeLine{01284\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ right\_sum\ \ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(right\_sum\_s)\ *\ color\_weight;}
\DoxyCodeLine{01285\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ lmrs\_sum\ \ \ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1a2e12d78738b0b4b550f57b2dc05f07}{vfloat3}}(left\_sum\_s,\ middle\_sum\_s,\ right\_sum\_s)\ *\ ls\_weight;}
\DoxyCodeLine{01286\ }
\DoxyCodeLine{01287\ \ \ \ \ \ \ \ \ color\_vec\_x\ =\ color\_vec\_x\ *\ color\_weight;}
\DoxyCodeLine{01288\ \ \ \ \ \ \ \ \ color\_vec\_y\ =\ color\_vec\_y\ *\ color\_weight;}
\DoxyCodeLine{01289\ }
\DoxyCodeLine{01290\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ the\ luminance\ and\ scale\ vectors\ with\ a\ reasonable\ default}}
\DoxyCodeLine{01291\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scalediv\ =\ scale\_min\ /\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(scale\_max,\ 1e-\/10f);}
\DoxyCodeLine{01292\ \ \ \ \ \ \ \ \ scalediv\ =\ \mbox{\hyperlink{namespaceastc_ac60307af42a98d70a956170894e29e9e}{astc::clamp1f}}(scalediv);}
\DoxyCodeLine{01293\ }
\DoxyCodeLine{01294\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ sds\ =\ scale\_dir\ *\ scale\_max;}
\DoxyCodeLine{01295\ }
\DoxyCodeLine{01296\ \ \ \ \ \ \ \ \ rgbs\_vectors[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ scalediv);}
\DoxyCodeLine{01297\ }
\DoxyCodeLine{01298\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wmin1\ >=\ wmax1\ *\ 0.999f)}
\DoxyCodeLine{01299\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ all\ weights\ in\ the\ partition\ were\ equal,\ then\ just\ take\ average\ of\ all\ colors\ in}}
\DoxyCodeLine{01301\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ partition\ and\ use\ that\ as\ both\ endpoint\ colors}}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ avg\ =\ (color\_vec\_x\ +\ color\_vec\_y)\ /\ rgba\_weight\_sum;}
\DoxyCodeLine{01303\ }
\DoxyCodeLine{01304\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ notnan\_mask\ =\ avg\ ==\ avg;}
\DoxyCodeLine{01305\ \ \ \ \ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i],\ avg,\ notnan\_mask);}
\DoxyCodeLine{01306\ \ \ \ \ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i],\ avg,\ notnan\_mask);}
\DoxyCodeLine{01307\ }
\DoxyCodeLine{01308\ \ \ \ \ \ \ \ \ \ \ \ \ rgbs\_vectors[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ 1.0f);}
\DoxyCodeLine{01309\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ complete\ the\ analytic\ calculation\ of\ ideal-\/endpoint-\/values\ for\ the\ given}}
\DoxyCodeLine{01313\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ of\ texel\ weights\ and\ pixel\ colors}}
\DoxyCodeLine{01314\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_det1\ =\ (left\_sum\ *\ right\_sum)\ -\/\ (middle\_sum\ *\ middle\_sum);}
\DoxyCodeLine{01315\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_rdet1\ =\ 1.0f\ /\ color\_det1;}
\DoxyCodeLine{01316\ }
\DoxyCodeLine{01317\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ ls\_det1\ \ =\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>()\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>())\ -\/\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>());}
\DoxyCodeLine{01318\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ ls\_rdet1\ =\ 1.0f\ /\ ls\_det1;}
\DoxyCodeLine{01319\ }
\DoxyCodeLine{01320\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_mss1\ =\ (left\_sum\ *\ left\_sum)}
\DoxyCodeLine{01321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (2.0f\ *\ middle\_sum\ *\ middle\_sum)}
\DoxyCodeLine{01322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (right\_sum\ *\ right\_sum);}
\DoxyCodeLine{01323\ }
\DoxyCodeLine{01324\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ ls\_mss1\ =\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>()\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>())}
\DoxyCodeLine{01325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (2.0f\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>())}
\DoxyCodeLine{01326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>()\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>());}
\DoxyCodeLine{01327\ }
\DoxyCodeLine{01328\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep0\ =\ (right\_sum\ *\ color\_vec\_x\ -\/\ middle\_sum\ *\ color\_vec\_y)\ *\ color\_rdet1;}
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep1\ =\ (left\_sum\ *\ color\_vec\_y\ -\/\ middle\_sum\ *\ color\_vec\_x)\ *\ color\_rdet1;}
\DoxyCodeLine{01330\ }
\DoxyCodeLine{01331\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ det\_mask\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aeac50750508168aeab5115733d3ee63c}{abs}}(color\_det1)\ >\ (color\_mss1\ *\ 1e-\/4f);}
\DoxyCodeLine{01332\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ notnan\_mask\ =\ (ep0\ ==\ ep0)\ \&\ (ep1\ ==\ ep1);}
\DoxyCodeLine{01333\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ full\_mask\ =\ det\_mask\ \&\ notnan\_mask;}
\DoxyCodeLine{01334\ }
\DoxyCodeLine{01335\ \ \ \ \ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i],\ ep0,\ full\_mask);}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i],\ ep1,\ full\_mask);}
\DoxyCodeLine{01337\ }
\DoxyCodeLine{01338\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\_ep0\ =\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>()\ *\ scale\_vec.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>()\ -\/\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()\ *\ scale\_vec.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>())\ *\ ls\_rdet1;}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\_ep1\ =\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>()\ *\ scale\_vec.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()\ -\/\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()\ *\ scale\_vec.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>())\ *\ ls\_rdet1;}
\DoxyCodeLine{01340\ }
\DoxyCodeLine{01341\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fabsf(ls\_det1)\ >\ (ls\_mss1\ *\ 1e-\/4f)\ \&\&\ scale\_ep0\ ==\ scale\_ep0\ \&\&\ scale\_ep1\ ==\ scale\_ep1\ \&\&\ scale\_ep0\ <\ scale\_ep1)}
\DoxyCodeLine{01342\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scalediv2\ =\ scale\_ep0\ /\ scale\_ep1;}
\DoxyCodeLine{01344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ sdsm\ =\ scale\_dir\ *\ scale\_ep1;}
\DoxyCodeLine{01345\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rgbs\_vectors[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(sdsm.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ sdsm.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ sdsm.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ scalediv2);}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01347\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01348\ }
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculations\ specific\ to\ mode\ \#7,\ the\ HDR\ RGB-\/scale\ mode\ -\/\ skip\ if\ known\ LDR}}
\DoxyCodeLine{01350\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (blk.\mbox{\hyperlink{structimage__block_af1a9e601f3d03dc488993b81258058e0}{rgb\_lns}}[0]\ ||\ blk.\mbox{\hyperlink{structimage__block_ade6f78d73e016d4e9222cbe89f5b1eec}{alpha\_lns}}[0])}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ weight\_weight\_sum\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(weight\_weight\_sum\_s)\ *\ color\_weight;}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ psum\ =\ right\_sum\_s\ *\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a48e833d0cfdf950b6bc3431fce00507e}{hadd\_rgb\_s}}(color\_weight);}
\DoxyCodeLine{01354\ }
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ rgbq\_sum\ =\ color\_vec\_x\ +\ color\_vec\_y;}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ \ \ \ \ rgbq\_sum.\mbox{\hyperlink{structvfloat4_a2168231efa1e514fd41b3603e57be297}{set\_lane}}<3>(\mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a48e833d0cfdf950b6bc3431fce00507e}{hadd\_rgb\_s}}(color\_vec\_y));}
\DoxyCodeLine{01357\ }
\DoxyCodeLine{01358\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ rgbovec\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a55d08b4feda289df7cbcfa6e1ed0b80c}{compute\_rgbo\_vector}}(rgba\_weight\_sum,\ weight\_weight\_sum,\ rgbq\_sum,\ psum);}
\DoxyCodeLine{01359\ \ \ \ \ \ \ \ \ \ \ \ \ rgbo\_vectors[i]\ =\ rgbovec;}
\DoxyCodeLine{01360\ }
\DoxyCodeLine{01361\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can\ get\ a\ failure\ due\ to\ the\ use\ of\ a\ singular\ (non-\/invertible)\ matrix}}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it\ failed,\ compute\ rgbo\_vectors[]\ with\ a\ different\ method\ ...}}
\DoxyCodeLine{01363\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespaceastc_aa80ae2eee0ffb5b754bdf0bb08b8759b}{astc::isnan}}(\mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a53a7d8285fd42b50cf3600a004db34ac}{dot\_s}}(rgbovec,\ rgbovec)))}
\DoxyCodeLine{01364\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ v0\ =\ ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[i];}
\DoxyCodeLine{01366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ v1\ =\ ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[i];}
\DoxyCodeLine{01367\ }
\DoxyCodeLine{01368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ avgdif\ =\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a48e833d0cfdf950b6bc3431fce00507e}{hadd\_rgb\_s}}(v1\ -\/\ v0)\ *\ (1.0f\ /\ 3.0f);}
\DoxyCodeLine{01369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ avgdif\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(avgdif,\ 0.0f);}
\DoxyCodeLine{01370\ }
\DoxyCodeLine{01371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ avg\ =\ (v0\ +\ v1)\ *\ 0.5f;}
\DoxyCodeLine{01372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep0\ =\ avg\ -\/\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(avgdif)\ *\ 0.5f;}
\DoxyCodeLine{01373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rgbo\_vectors[i]\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ avgdif);}
\DoxyCodeLine{01374\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01376\ \ \ \ \ \}}
\DoxyCodeLine{01377\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{astcenc__ideal__endpoints__and__weights_8cpp_a02bcad94240678ee727ccf2f0fbfb5d3_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_a02bcad94240678ee727ccf2f0fbfb5d3_icgraph}
\end{center}
\end{figure}
\Hypertarget{astcenc__ideal__endpoints__and__weights_8cpp_afb3c455470bef24f48d7815bb78bb569}\index{astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}!recompute\_ideal\_colors\_2planes@{recompute\_ideal\_colors\_2planes}}
\index{recompute\_ideal\_colors\_2planes@{recompute\_ideal\_colors\_2planes}!astcenc\_ideal\_endpoints\_and\_weights.cpp@{astcenc\_ideal\_endpoints\_and\_weights.cpp}}
\doxysubsubsection{\texorpdfstring{recompute\_ideal\_colors\_2planes()}{recompute\_ideal\_colors\_2planes()}}
{\footnotesize\ttfamily \label{astcenc__ideal__endpoints__and__weights_8cpp_afb3c455470bef24f48d7815bb78bb569} 
void recompute\+\_\+ideal\+\_\+colors\+\_\+2planes (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structimage__block}{image\+\_\+block}} \&}]{blk}{, }\item[{const \mbox{\hyperlink{structblock__size__descriptor}{block\+\_\+size\+\_\+descriptor}} \&}]{bsd}{, }\item[{const \mbox{\hyperlink{structdecimation__info}{decimation\+\_\+info}} \&}]{di}{, }\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{dec\+\_\+weights\+\_\+uquant\+\_\+plane1}{, }\item[{const uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{dec\+\_\+weights\+\_\+uquant\+\_\+plane2}{, }\item[{\mbox{\hyperlink{structendpoints}{endpoints}} \&}]{ep}{, }\item[{\mbox{\hyperlink{structvfloat4}{vfloat4}} \&}]{rgbs\+\_\+vector}{, }\item[{\mbox{\hyperlink{structvfloat4}{vfloat4}} \&}]{rgbo\+\_\+vector}{, }\item[{int}]{plane2\+\_\+component}{}\end{DoxyParamCaption})}



For a given 2 plane weight set recompute the endpoint colors. 

As we quantize and decimate weights the optimal endpoint colors may change slightly, so we must recompute the ideal colors for a specific weight set.


\begin{DoxyParams}[1]{매개변수}
 & {\em blk} & The image block color data to compress. \\
\hline
 & {\em bsd} & The block\+\_\+size descriptor. \\
\hline
 & {\em di} & The weight grid decimation table. \\
\hline
 & {\em dec\+\_\+weights\+\_\+uquant\+\_\+plane1} & The quantized weight set for plane 1. \\
\hline
 & {\em dec\+\_\+weights\+\_\+uquant\+\_\+plane2} & The quantized weight set for plane 2. \\
\hline
\mbox{\texttt{ in,out}}  & {\em ep} & The color endpoints (modifed in place). \\
\hline
\mbox{\texttt{ out}}  & {\em rgbs\+\_\+vector} & The RGB+scale color for LDR blocks. \\
\hline
\mbox{\texttt{ out}}  & {\em rgbo\+\_\+vector} & The RGB+offset color for HDR blocks. \\
\hline
 & {\em plane2\+\_\+component} & The component assigned to plane 2. \\
\hline
\end{DoxyParams}


\mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source}{astcenc\+\_\+ideal\+\_\+endpoints\+\_\+and\+\_\+weights.\+cpp}} 파일의 \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_source_l01380}{1380}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{01390\ \ \ \{}
\DoxyCodeLine{01391\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ weight\_count\ =\ di.\mbox{\hyperlink{structdecimation__info_af7d0c86be805995a20a6c09f6c3ab8ca}{weight\_count}};}
\DoxyCodeLine{01392\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ total\_texel\_count\ =\ blk.\mbox{\hyperlink{structimage__block_a05174b1db0b9131ad61fc49f3aa74676}{texel\_count}};}
\DoxyCodeLine{01393\ }
\DoxyCodeLine{01394\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(total\_texel\_count\ >\ 0);}
\DoxyCodeLine{01395\ \ \ \ \ \mbox{\hyperlink{astcenc__internal_8h_a2cce51c3362aa0b5040437ac0e7f8969}{promise}}(weight\_count\ >\ 0);}
\DoxyCodeLine{01396\ }
\DoxyCodeLine{01397\ \ \ \ \ \mbox{\hyperlink{astcenc__mathlib_8h_adf60643d2894fb1d3cd00d4f907186e8}{ASTCENC\_ALIGNAS}}\ \textcolor{keywordtype}{float}\ dec\_weight\_plane1[\mbox{\hyperlink{astcenc__internal_8h_a4135969a5d69e8805250b420dcccf460}{BLOCK\_MAX\_WEIGHTS\_2PLANE}}];}
\DoxyCodeLine{01398\ \ \ \ \ \mbox{\hyperlink{astcenc__mathlib_8h_adf60643d2894fb1d3cd00d4f907186e8}{ASTCENC\_ALIGNAS}}\ \textcolor{keywordtype}{float}\ dec\_weight\_plane2[\mbox{\hyperlink{astcenc__internal_8h_a4135969a5d69e8805250b420dcccf460}{BLOCK\_MAX\_WEIGHTS\_2PLANE}}];}
\DoxyCodeLine{01399\ }
\DoxyCodeLine{01400\ \ \ \ \ assert(weight\_count\ <=\ \mbox{\hyperlink{astcenc__internal_8h_a4135969a5d69e8805250b420dcccf460}{BLOCK\_MAX\_WEIGHTS\_2PLANE}});}
\DoxyCodeLine{01401\ }
\DoxyCodeLine{01402\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ weight\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{01403\ \ \ \ \ \{}
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ unquant\_value1(dec\_weights\_uquant\_plane1\ +\ i);}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ unquant\_value1f\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a3a2ce0fb403294db7fe126a6b3e87ab7}{int\_to\_float}}(unquant\_value1)\ *\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a3a29c3b15144cf0836ca0f4740b73d00}{vfloat}}(1.0f\ /\ 64.0f);}
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(unquant\_value1f,\ dec\_weight\_plane1\ +\ i);}
\DoxyCodeLine{01407\ }
\DoxyCodeLine{01408\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvint4}{vint}}\ unquant\_value2(dec\_weights\_uquant\_plane2\ +\ i);}
\DoxyCodeLine{01409\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ unquant\_value2f\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a3a2ce0fb403294db7fe126a6b3e87ab7}{int\_to\_float}}(unquant\_value2)\ *\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a3a29c3b15144cf0836ca0f4740b73d00}{vfloat}}(1.0f\ /\ 64.0f);}
\DoxyCodeLine{01410\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(unquant\_value2f,\ dec\_weight\_plane2\ +\ i);}
\DoxyCodeLine{01411\ \ \ \ \ \}}
\DoxyCodeLine{01412\ }
\DoxyCodeLine{01413\ \ \ \ \ \mbox{\hyperlink{astcenc__mathlib_8h_adf60643d2894fb1d3cd00d4f907186e8}{ASTCENC\_ALIGNAS}}\ \textcolor{keywordtype}{float}\ undec\_weight\_plane1[\mbox{\hyperlink{astcenc__internal_8h_ad694a8ff82a68a50b11bac439531241e}{BLOCK\_MAX\_TEXELS}}];}
\DoxyCodeLine{01414\ \ \ \ \ \mbox{\hyperlink{astcenc__mathlib_8h_adf60643d2894fb1d3cd00d4f907186e8}{ASTCENC\_ALIGNAS}}\ \textcolor{keywordtype}{float}\ undec\_weight\_plane2[\mbox{\hyperlink{astcenc__internal_8h_ad694a8ff82a68a50b11bac439531241e}{BLOCK\_MAX\_TEXELS}}];}
\DoxyCodeLine{01415\ }
\DoxyCodeLine{01416\ \ \ \ \ \textcolor{keywordtype}{float}*\ undec\_weight\_plane1\_ref;}
\DoxyCodeLine{01417\ \ \ \ \ \textcolor{keywordtype}{float}*\ undec\_weight\_plane2\_ref;}
\DoxyCodeLine{01418\ }
\DoxyCodeLine{01419\ \ \ \ \ \textcolor{keywordflow}{if}\ (di.\mbox{\hyperlink{structdecimation__info_a1419dcd0f618164042315f80527d3f4f}{max\_texel\_weight\_count}}\ ==\ 1)}
\DoxyCodeLine{01420\ \ \ \ \ \{}
\DoxyCodeLine{01421\ \ \ \ \ \ \ \ \ undec\_weight\_plane1\_ref\ =\ dec\_weight\_plane1;}
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ undec\_weight\_plane2\_ref\ =\ dec\_weight\_plane2;}
\DoxyCodeLine{01423\ \ \ \ \ \}}
\DoxyCodeLine{01424\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (di.\mbox{\hyperlink{structdecimation__info_a1419dcd0f618164042315f80527d3f4f}{max\_texel\_weight\_count}}\ <=\ 2)}
\DoxyCodeLine{01425\ \ \ \ \ \{}
\DoxyCodeLine{01426\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ total\_texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{01427\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01428\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45}{bilinear\_infill\_vla\_2}}(di,\ dec\_weight\_plane1,\ i);}
\DoxyCodeLine{01429\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(weight,\ undec\_weight\_plane1\ +\ i);}
\DoxyCodeLine{01430\ }
\DoxyCodeLine{01431\ \ \ \ \ \ \ \ \ \ \ \ \ weight\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a84286bd889620da3be77539ddfdf3b45}{bilinear\_infill\_vla\_2}}(di,\ dec\_weight\_plane2,\ i);}
\DoxyCodeLine{01432\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(weight,\ undec\_weight\_plane2\ +\ i);}
\DoxyCodeLine{01433\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01434\ }
\DoxyCodeLine{01435\ \ \ \ \ \ \ \ \ undec\_weight\_plane1\_ref\ =\ undec\_weight\_plane1;}
\DoxyCodeLine{01436\ \ \ \ \ \ \ \ \ undec\_weight\_plane2\_ref\ =\ undec\_weight\_plane2;}
\DoxyCodeLine{01437\ \ \ \ \ \}}
\DoxyCodeLine{01438\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01439\ \ \ \ \ \{}
\DoxyCodeLine{01440\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ total\_texel\_count;\ i\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_aaf679f3389069313db808a4ebd6af8ad}{ASTCENC\_SIMD\_WIDTH}})}
\DoxyCodeLine{01441\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01442\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat}}\ weight\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca}{bilinear\_infill\_vla}}(di,\ dec\_weight\_plane1,\ i);}
\DoxyCodeLine{01443\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(weight,\ undec\_weight\_plane1\ +\ i);}
\DoxyCodeLine{01444\ }
\DoxyCodeLine{01445\ \ \ \ \ \ \ \ \ \ \ \ \ weight\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a617a8dec1d2168023a84f5c0fa1c20ca}{bilinear\_infill\_vla}}(di,\ dec\_weight\_plane2,\ i);}
\DoxyCodeLine{01446\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_ad4c0a7bde35d6fe9c54531e1e0652f4a}{storea}}(weight,\ undec\_weight\_plane2\ +\ i);}
\DoxyCodeLine{01447\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01448\ }
\DoxyCodeLine{01449\ \ \ \ \ \ \ \ \ undec\_weight\_plane1\_ref\ =\ undec\_weight\_plane1;}
\DoxyCodeLine{01450\ \ \ \ \ \ \ \ \ undec\_weight\_plane2\_ref\ =\ undec\_weight\_plane2;}
\DoxyCodeLine{01451\ \ \ \ \ \}}
\DoxyCodeLine{01452\ }
\DoxyCodeLine{01453\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ texel\_count\ =\ bsd.\mbox{\hyperlink{structblock__size__descriptor_a0df466b2eda6958f2e5f8a4f147367e4}{texel\_count}};}
\DoxyCodeLine{01454\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ rgba\_weight\_sum\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aa162915c044e97cc1f6d630338761fd3}{max}}(blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}}\ *\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(texel\_count),\ 1e-\/17f);}
\DoxyCodeLine{01455\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ scale\_dir\ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a48bcfcd0946caec9323acbf4bf1126ce}{normalize}}(blk.\mbox{\hyperlink{structimage__block_ac6bd4890338be887b61f857e37d23459}{data\_mean}}.\mbox{\hyperlink{structvfloat4_a0a3e390831722cc8e54f29155699f3a5}{swz}}<0,\ 1,\ 2>());}
\DoxyCodeLine{01456\ }
\DoxyCodeLine{01457\ \ \ \ \ \textcolor{keywordtype}{float}\ scale\_max\ =\ 0.0f;}
\DoxyCodeLine{01458\ \ \ \ \ \textcolor{keywordtype}{float}\ scale\_min\ =\ 1e10f;}
\DoxyCodeLine{01459\ }
\DoxyCodeLine{01460\ \ \ \ \ \textcolor{keywordtype}{float}\ wmin1\ =\ 1.0f;}
\DoxyCodeLine{01461\ \ \ \ \ \textcolor{keywordtype}{float}\ wmax1\ =\ 0.0f;}
\DoxyCodeLine{01462\ }
\DoxyCodeLine{01463\ \ \ \ \ \textcolor{keywordtype}{float}\ wmin2\ =\ 1.0f;}
\DoxyCodeLine{01464\ \ \ \ \ \textcolor{keywordtype}{float}\ wmax2\ =\ 0.0f;}
\DoxyCodeLine{01465\ }
\DoxyCodeLine{01466\ \ \ \ \ \textcolor{keywordtype}{float}\ left1\_sum\_s\ =\ 0.0f;}
\DoxyCodeLine{01467\ \ \ \ \ \textcolor{keywordtype}{float}\ middle1\_sum\_s\ =\ 0.0f;}
\DoxyCodeLine{01468\ \ \ \ \ \textcolor{keywordtype}{float}\ right1\_sum\_s\ =\ 0.0f;}
\DoxyCodeLine{01469\ }
\DoxyCodeLine{01470\ \ \ \ \ \textcolor{keywordtype}{float}\ left2\_sum\_s\ =\ 0.0f;}
\DoxyCodeLine{01471\ \ \ \ \ \textcolor{keywordtype}{float}\ middle2\_sum\_s\ =\ 0.0f;}
\DoxyCodeLine{01472\ \ \ \ \ \textcolor{keywordtype}{float}\ right2\_sum\_s\ =\ 0.0f;}
\DoxyCodeLine{01473\ }
\DoxyCodeLine{01474\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_vec\_x\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat4::zero}}();}
\DoxyCodeLine{01475\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_vec\_y\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat4::zero}}();}
\DoxyCodeLine{01476\ }
\DoxyCodeLine{01477\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ scale\_vec\ =\ \mbox{\hyperlink{structvfloat4_a04b5f338012dab6be0b2bd7910fcbcae}{vfloat4::zero}}();}
\DoxyCodeLine{01478\ }
\DoxyCodeLine{01479\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ weight\_weight\_sum\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(1e-\/17f);}
\DoxyCodeLine{01480\ }
\DoxyCodeLine{01481\ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ p2\_mask\ =\ \mbox{\hyperlink{structvint4_a21e3d111e37da1aaaeb5ba21a831c863}{vint4::lane\_id}}()\ ==\ \mbox{\hyperlink{structvint4}{vint4}}(plane2\_component);}
\DoxyCodeLine{01482\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_weight\ =\ blk.\mbox{\hyperlink{structimage__block_a6fd749c93e25e5e96748a10387c24a77}{channel\_weight}};}
\DoxyCodeLine{01483\ \ \ \ \ \textcolor{keywordtype}{float}\ ls\_weight\ =\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a48e833d0cfdf950b6bc3431fce00507e}{hadd\_rgb\_s}}(color\_weight);}
\DoxyCodeLine{01484\ }
\DoxyCodeLine{01485\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ texel\_count;\ j++)}
\DoxyCodeLine{01486\ \ \ \ \ \{}
\DoxyCodeLine{01487\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ rgba\ =\ blk.\mbox{\hyperlink{structimage__block_af99de7d75e1e380b31d70d131509caa9}{texel}}(j);}
\DoxyCodeLine{01488\ }
\DoxyCodeLine{01489\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ idx0\ =\ undec\_weight\_plane1\_ref[j];}
\DoxyCodeLine{01490\ }
\DoxyCodeLine{01491\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ om\_idx0\ =\ 1.0f\ -\/\ idx0;}
\DoxyCodeLine{01492\ \ \ \ \ \ \ \ \ wmin1\ =\ \mbox{\hyperlink{namespaceastc_af78c0d31374aa9923633a3a2abf8d738}{astc::min}}(idx0,\ wmin1);}
\DoxyCodeLine{01493\ \ \ \ \ \ \ \ \ wmax1\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(idx0,\ wmax1);}
\DoxyCodeLine{01494\ }
\DoxyCodeLine{01495\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\ =\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a377cafdb98d3ee38a2999ed00504f477}{dot3\_s}}(scale\_dir,\ rgba);}
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ \ scale\_min\ =\ \mbox{\hyperlink{namespaceastc_af78c0d31374aa9923633a3a2abf8d738}{astc::min}}(scale,\ scale\_min);}
\DoxyCodeLine{01497\ \ \ \ \ \ \ \ \ scale\_max\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(scale,\ scale\_max);}
\DoxyCodeLine{01498\ }
\DoxyCodeLine{01499\ \ \ \ \ \ \ \ \ left1\_sum\_s\ \ \ +=\ om\_idx0\ *\ om\_idx0;}
\DoxyCodeLine{01500\ \ \ \ \ \ \ \ \ middle1\_sum\_s\ +=\ om\_idx0\ *\ idx0;}
\DoxyCodeLine{01501\ \ \ \ \ \ \ \ \ right1\_sum\_s\ \ +=\ idx0\ *\ idx0;}
\DoxyCodeLine{01502\ }
\DoxyCodeLine{01503\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ idx1\ =\ undec\_weight\_plane2\_ref[j];}
\DoxyCodeLine{01504\ }
\DoxyCodeLine{01505\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ om\_idx1\ =\ 1.0f\ -\/\ idx1;}
\DoxyCodeLine{01506\ \ \ \ \ \ \ \ \ wmin2\ =\ \mbox{\hyperlink{namespaceastc_af78c0d31374aa9923633a3a2abf8d738}{astc::min}}(idx1,\ wmin2);}
\DoxyCodeLine{01507\ \ \ \ \ \ \ \ \ wmax2\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(idx1,\ wmax2);}
\DoxyCodeLine{01508\ }
\DoxyCodeLine{01509\ \ \ \ \ \ \ \ \ left2\_sum\_s\ \ \ +=\ om\_idx1\ *\ om\_idx1;}
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ middle2\_sum\_s\ +=\ om\_idx1\ *\ idx1;}
\DoxyCodeLine{01511\ \ \ \ \ \ \ \ \ right2\_sum\_s\ \ +=\ idx1\ *\ idx1;}
\DoxyCodeLine{01512\ }
\DoxyCodeLine{01513\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_idx\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(\mbox{\hyperlink{structvfloat4}{vfloat4}}(idx0),\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(idx1),\ p2\_mask);}
\DoxyCodeLine{01514\ }
\DoxyCodeLine{01515\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ cwprod\ =\ rgba;}
\DoxyCodeLine{01516\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ cwiprod\ =\ cwprod\ *\ color\_idx;}
\DoxyCodeLine{01517\ }
\DoxyCodeLine{01518\ \ \ \ \ \ \ \ \ color\_vec\_y\ +=\ cwiprod;}
\DoxyCodeLine{01519\ \ \ \ \ \ \ \ \ color\_vec\_x\ +=\ cwprod\ -\/\ cwiprod;}
\DoxyCodeLine{01520\ }
\DoxyCodeLine{01521\ \ \ \ \ \ \ \ \ scale\_vec\ +=\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a4750532a1dbacf2063927a027725afde}{vfloat2}}(om\_idx0,\ idx0)\ *\ (ls\_weight\ *\ scale);}
\DoxyCodeLine{01522\ \ \ \ \ \ \ \ \ weight\_weight\_sum\ +=\ color\_idx;}
\DoxyCodeLine{01523\ \ \ \ \ \}}
\DoxyCodeLine{01524\ }
\DoxyCodeLine{01525\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ left1\_sum\ \ \ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(left1\_sum\_s)\ *\ color\_weight;}
\DoxyCodeLine{01526\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ middle1\_sum\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(middle1\_sum\_s)\ *\ color\_weight;}
\DoxyCodeLine{01527\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ right1\_sum\ \ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(right1\_sum\_s)\ *\ color\_weight;}
\DoxyCodeLine{01528\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ lmrs\_sum\ \ \ \ =\ \mbox{\hyperlink{astcenc__vecmathlib_8h_a1a2e12d78738b0b4b550f57b2dc05f07}{vfloat3}}(left1\_sum\_s,\ middle1\_sum\_s,\ right1\_sum\_s)\ *\ ls\_weight;}
\DoxyCodeLine{01529\ }
\DoxyCodeLine{01530\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ left2\_sum\ \ \ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(left2\_sum\_s)\ *\ color\_weight;}
\DoxyCodeLine{01531\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ middle2\_sum\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(middle2\_sum\_s)\ *\ color\_weight;}
\DoxyCodeLine{01532\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ right2\_sum\ \ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(right2\_sum\_s)\ *\ color\_weight;}
\DoxyCodeLine{01533\ }
\DoxyCodeLine{01534\ \ \ \ \ color\_vec\_x\ =\ color\_vec\_x\ *\ color\_weight;}
\DoxyCodeLine{01535\ \ \ \ \ color\_vec\_y\ =\ color\_vec\_y\ *\ color\_weight;}
\DoxyCodeLine{01536\ }
\DoxyCodeLine{01537\ \ \ \ \ \textcolor{comment}{//\ Initialize\ the\ luminance\ and\ scale\ vectors\ with\ a\ reasonable\ default}}
\DoxyCodeLine{01538\ \ \ \ \ \textcolor{keywordtype}{float}\ scalediv\ =\ scale\_min\ /\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(scale\_max,\ 1e-\/10f);}
\DoxyCodeLine{01539\ \ \ \ \ scalediv\ =\ \mbox{\hyperlink{namespaceastc_ac60307af42a98d70a956170894e29e9e}{astc::clamp1f}}(scalediv);}
\DoxyCodeLine{01540\ }
\DoxyCodeLine{01541\ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ sds\ =\ scale\_dir\ *\ scale\_max;}
\DoxyCodeLine{01542\ }
\DoxyCodeLine{01543\ \ \ \ \ rgbs\_vector\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ scalediv);}
\DoxyCodeLine{01544\ }
\DoxyCodeLine{01545\ \ \ \ \ \textcolor{keywordflow}{if}\ (wmin1\ >=\ wmax1\ *\ 0.999f)}
\DoxyCodeLine{01546\ \ \ \ \ \{}
\DoxyCodeLine{01547\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ all\ weights\ in\ the\ partition\ were\ equal,\ then\ just\ take\ average\ of\ all\ colors\ in}}
\DoxyCodeLine{01548\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ partition\ and\ use\ that\ as\ both\ endpoint\ colors}}
\DoxyCodeLine{01549\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ avg\ =\ (color\_vec\_x\ +\ color\_vec\_y)\ /\ rgba\_weight\_sum;}
\DoxyCodeLine{01550\ }
\DoxyCodeLine{01551\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ p1\_mask\ =\ \mbox{\hyperlink{structvint4_a21e3d111e37da1aaaeb5ba21a831c863}{vint4::lane\_id}}()\ !=\ \mbox{\hyperlink{structvint4}{vint4}}(plane2\_component);}
\DoxyCodeLine{01552\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ notnan\_mask\ =\ avg\ ==\ avg;}
\DoxyCodeLine{01553\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ full\_mask\ =\ p1\_mask\ \&\ notnan\_mask;}
\DoxyCodeLine{01554\ }
\DoxyCodeLine{01555\ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[0]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[0],\ avg,\ full\_mask);}
\DoxyCodeLine{01556\ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[0]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[0],\ avg,\ full\_mask);}
\DoxyCodeLine{01557\ }
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ \ rgbs\_vector\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ sds.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ 1.0f);}
\DoxyCodeLine{01559\ \ \ \ \ \}}
\DoxyCodeLine{01560\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01561\ \ \ \ \ \{}
\DoxyCodeLine{01562\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ complete\ the\ analytic\ calculation\ of\ ideal-\/endpoint-\/values\ for\ the\ given}}
\DoxyCodeLine{01563\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ of\ texel\ weights\ and\ pixel\ colors}}
\DoxyCodeLine{01564\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_det1\ =\ (left1\_sum\ *\ right1\_sum)\ -\/\ (middle1\_sum\ *\ middle1\_sum);}
\DoxyCodeLine{01565\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_rdet1\ =\ 1.0f\ /\ color\_det1;}
\DoxyCodeLine{01566\ }
\DoxyCodeLine{01567\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ ls\_det1\ \ =\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>()\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>())\ -\/\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>());}
\DoxyCodeLine{01568\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ ls\_rdet1\ =\ 1.0f\ /\ ls\_det1;}
\DoxyCodeLine{01569\ }
\DoxyCodeLine{01570\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_mss1\ =\ (left1\_sum\ *\ left1\_sum)}
\DoxyCodeLine{01571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (2.0f\ *\ middle1\_sum\ *\ middle1\_sum)}
\DoxyCodeLine{01572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (right1\_sum\ *\ right1\_sum);}
\DoxyCodeLine{01573\ }
\DoxyCodeLine{01574\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ ls\_mss1\ =\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>()\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>())}
\DoxyCodeLine{01575\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (2.0f\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>())}
\DoxyCodeLine{01576\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>()\ *\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>());}
\DoxyCodeLine{01577\ }
\DoxyCodeLine{01578\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep0\ =\ (right1\_sum\ *\ color\_vec\_x\ -\/\ middle1\_sum\ *\ color\_vec\_y)\ *\ color\_rdet1;}
\DoxyCodeLine{01579\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep1\ =\ (left1\_sum\ *\ color\_vec\_y\ -\/\ middle1\_sum\ *\ color\_vec\_x)\ *\ color\_rdet1;}
\DoxyCodeLine{01580\ }
\DoxyCodeLine{01581\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\_ep0\ =\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>()\ *\ scale\_vec.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>()\ -\/\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()\ *\ scale\_vec.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>())\ *\ ls\_rdet1;}
\DoxyCodeLine{01582\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scale\_ep1\ =\ (lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>()\ *\ scale\_vec.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()\ -\/\ lmrs\_sum.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>()\ *\ scale\_vec.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>())\ *\ ls\_rdet1;}
\DoxyCodeLine{01583\ }
\DoxyCodeLine{01584\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ p1\_mask\ =\ \mbox{\hyperlink{structvint4_a21e3d111e37da1aaaeb5ba21a831c863}{vint4::lane\_id}}()\ !=\ \mbox{\hyperlink{structvint4}{vint4}}(plane2\_component);}
\DoxyCodeLine{01585\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ det\_mask\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aeac50750508168aeab5115733d3ee63c}{abs}}(color\_det1)\ >\ (color\_mss1\ *\ 1e-\/4f);}
\DoxyCodeLine{01586\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ notnan\_mask\ =\ (ep0\ ==\ ep0)\ \&\ (ep1\ ==\ ep1);}
\DoxyCodeLine{01587\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ full\_mask\ =\ p1\_mask\ \&\ det\_mask\ \&\ notnan\_mask;}
\DoxyCodeLine{01588\ }
\DoxyCodeLine{01589\ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[0]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[0],\ ep0,\ full\_mask);}
\DoxyCodeLine{01590\ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[0]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[0],\ ep1,\ full\_mask);}
\DoxyCodeLine{01591\ }
\DoxyCodeLine{01592\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fabsf(ls\_det1)\ >\ (ls\_mss1\ *\ 1e-\/4f)\ \&\&\ scale\_ep0\ ==\ scale\_ep0\ \&\&\ scale\_ep1\ ==\ scale\_ep1\ \&\&\ scale\_ep0\ <\ scale\_ep1)}
\DoxyCodeLine{01593\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01594\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ scalediv2\ =\ scale\_ep0\ /\ scale\_ep1;}
\DoxyCodeLine{01595\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ sdsm\ =\ scale\_dir\ *\ scale\_ep1;}
\DoxyCodeLine{01596\ \ \ \ \ \ \ \ \ \ \ \ \ rgbs\_vector\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(sdsm.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ sdsm.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ sdsm.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ scalediv2);}
\DoxyCodeLine{01597\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01598\ \ \ \ \ \}}
\DoxyCodeLine{01599\ }
\DoxyCodeLine{01600\ \ \ \ \ \textcolor{keywordflow}{if}\ (wmin2\ >=\ wmax2\ *\ 0.999f)}
\DoxyCodeLine{01601\ \ \ \ \ \{}
\DoxyCodeLine{01602\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ all\ weights\ in\ the\ partition\ were\ equal,\ then\ just\ take\ average\ of\ all\ colors\ in}}
\DoxyCodeLine{01603\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ partition\ and\ use\ that\ as\ both\ endpoint\ colors}}
\DoxyCodeLine{01604\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ avg\ =\ (color\_vec\_x\ +\ color\_vec\_y)\ /\ rgba\_weight\_sum;}
\DoxyCodeLine{01605\ }
\DoxyCodeLine{01606\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ notnan\_mask\ =\ avg\ ==\ avg;}
\DoxyCodeLine{01607\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ full\_mask\ =\ p2\_mask\ \&\ notnan\_mask;}
\DoxyCodeLine{01608\ }
\DoxyCodeLine{01609\ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[0]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[0],\ avg,\ full\_mask);}
\DoxyCodeLine{01610\ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[0]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[0],\ avg,\ full\_mask);}
\DoxyCodeLine{01611\ \ \ \ \ \}}
\DoxyCodeLine{01612\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01613\ \ \ \ \ \{}
\DoxyCodeLine{01614\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ complete\ the\ analytic\ calculation\ of\ ideal-\/endpoint-\/values\ for\ the\ given}}
\DoxyCodeLine{01615\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ of\ texel\ weights\ and\ pixel\ colors}}
\DoxyCodeLine{01616\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_det2\ =\ (left2\_sum\ *\ right2\_sum)\ -\/\ (middle2\_sum\ *\ middle2\_sum);}
\DoxyCodeLine{01617\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_rdet2\ =\ 1.0f\ /\ color\_det2;}
\DoxyCodeLine{01618\ }
\DoxyCodeLine{01619\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ color\_mss2\ =\ (left2\_sum\ *\ left2\_sum)}
\DoxyCodeLine{01620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (2.0f\ *\ middle2\_sum\ *\ middle2\_sum)}
\DoxyCodeLine{01621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (right2\_sum\ *\ right2\_sum);}
\DoxyCodeLine{01622\ }
\DoxyCodeLine{01623\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep0\ =\ (right2\_sum\ *\ color\_vec\_x\ -\/\ middle2\_sum\ *\ color\_vec\_y)\ *\ color\_rdet2;}
\DoxyCodeLine{01624\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep1\ =\ (left2\_sum\ *\ color\_vec\_y\ -\/\ middle2\_sum\ *\ color\_vec\_x)\ *\ color\_rdet2;}
\DoxyCodeLine{01625\ }
\DoxyCodeLine{01626\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ det\_mask\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_aeac50750508168aeab5115733d3ee63c}{abs}}(color\_det2)\ >\ (color\_mss2\ *\ 1e-\/4f);}
\DoxyCodeLine{01627\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ notnan\_mask\ =\ (ep0\ ==\ ep0)\ \&\ (ep1\ ==\ ep1);}
\DoxyCodeLine{01628\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvmask4}{vmask4}}\ full\_mask\ =\ p2\_mask\ \&\ det\_mask\ \&\ notnan\_mask;}
\DoxyCodeLine{01629\ }
\DoxyCodeLine{01630\ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[0]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[0],\ ep0,\ full\_mask);}
\DoxyCodeLine{01631\ \ \ \ \ \ \ \ \ ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[0]\ =\ \mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[0],\ ep1,\ full\_mask);}
\DoxyCodeLine{01632\ \ \ \ \ \}}
\DoxyCodeLine{01633\ }
\DoxyCodeLine{01634\ \ \ \ \ \textcolor{comment}{//\ Calculations\ specific\ to\ mode\ \#7,\ the\ HDR\ RGB-\/scale\ mode\ -\/\ skip\ if\ known\ LDR}}
\DoxyCodeLine{01635\ \ \ \ \ \textcolor{keywordflow}{if}\ (blk.\mbox{\hyperlink{structimage__block_af1a9e601f3d03dc488993b81258058e0}{rgb\_lns}}[0]\ ||\ blk.\mbox{\hyperlink{structimage__block_ade6f78d73e016d4e9222cbe89f5b1eec}{alpha\_lns}}[0])}
\DoxyCodeLine{01636\ \ \ \ \ \{}
\DoxyCodeLine{01637\ \ \ \ \ \ \ \ \ weight\_weight\_sum\ =\ weight\_weight\_sum\ *\ color\_weight;}
\DoxyCodeLine{01638\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ psum\ =\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a377cafdb98d3ee38a2999ed00504f477}{dot3\_s}}(\mbox{\hyperlink{astcenc__vecmathlib__avx2__8_8h_a844ab5b69b84569f033be33bf5fb9fbc}{select}}(right1\_sum,\ right2\_sum,\ p2\_mask),\ color\_weight);}
\DoxyCodeLine{01639\ }
\DoxyCodeLine{01640\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ rgbq\_sum\ =\ color\_vec\_x\ +\ color\_vec\_y;}
\DoxyCodeLine{01641\ \ \ \ \ \ \ \ \ rgbq\_sum.\mbox{\hyperlink{structvfloat4_a2168231efa1e514fd41b3603e57be297}{set\_lane}}<3>(\mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a48e833d0cfdf950b6bc3431fce00507e}{hadd\_rgb\_s}}(color\_vec\_y));}
\DoxyCodeLine{01642\ }
\DoxyCodeLine{01643\ \ \ \ \ \ \ \ \ rgbo\_vector\ =\ \mbox{\hyperlink{astcenc__ideal__endpoints__and__weights_8cpp_a55d08b4feda289df7cbcfa6e1ed0b80c}{compute\_rgbo\_vector}}(rgba\_weight\_sum,\ weight\_weight\_sum,\ rgbq\_sum,\ psum);}
\DoxyCodeLine{01644\ }
\DoxyCodeLine{01645\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can\ get\ a\ failure\ due\ to\ the\ use\ of\ a\ singular\ (non-\/invertible)\ matrix}}
\DoxyCodeLine{01646\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it\ failed,\ compute\ rgbo\_vectors[]\ with\ a\ different\ method\ ...}}
\DoxyCodeLine{01647\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespaceastc_aa80ae2eee0ffb5b754bdf0bb08b8759b}{astc::isnan}}(\mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a53a7d8285fd42b50cf3600a004db34ac}{dot\_s}}(rgbo\_vector,\ rgbo\_vector)))}
\DoxyCodeLine{01648\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01649\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ v0\ =\ ep.\mbox{\hyperlink{structendpoints_a2a084800ec101a03de2b8deb0d926263}{endpt0}}[0];}
\DoxyCodeLine{01650\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ v1\ =\ ep.\mbox{\hyperlink{structendpoints_a89660f637b681eaea32e7db6b9d9def2}{endpt1}}[0];}
\DoxyCodeLine{01651\ }
\DoxyCodeLine{01652\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ avgdif\ =\ \mbox{\hyperlink{astcenc__vecmathlib__common__4_8h_a48e833d0cfdf950b6bc3431fce00507e}{hadd\_rgb\_s}}(v1\ -\/\ v0)\ *\ (1.0f\ /\ 3.0f);}
\DoxyCodeLine{01653\ \ \ \ \ \ \ \ \ \ \ \ \ avgdif\ =\ \mbox{\hyperlink{namespaceastc_a83a55552d03399cdff6cf2fed8312c9f}{astc::max}}(avgdif,\ 0.0f);}
\DoxyCodeLine{01654\ }
\DoxyCodeLine{01655\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ avg\ =\ (v0\ +\ v1)\ *\ 0.5f;}
\DoxyCodeLine{01656\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvfloat4}{vfloat4}}\ ep0\ =\ avg\ -\/\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(avgdif)\ *\ 0.5f;}
\DoxyCodeLine{01657\ }
\DoxyCodeLine{01658\ \ \ \ \ \ \ \ \ \ \ \ \ rgbo\_vector\ =\ \mbox{\hyperlink{structvfloat4}{vfloat4}}(ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<0>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<1>(),\ ep0.\mbox{\hyperlink{structvfloat4_a04462a7815432c6bc3ce1b5e5d11e4fc}{lane}}<2>(),\ avgdif);}
\DoxyCodeLine{01659\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01660\ \ \ \ \ \}}
\DoxyCodeLine{01661\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{astcenc__ideal__endpoints__and__weights_8cpp_afb3c455470bef24f48d7815bb78bb569_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{astcenc__ideal__endpoints__and__weights_8cpp_afb3c455470bef24f48d7815bb78bb569_icgraph}
\end{center}
\end{figure}
